window.ONEBOOK3DTHEBEST=!0;var ONEBOOK3D_ADDITIONAL_LANGUAGES=[{lng:"it",save:"Salva",light:"Luminoso",dark:"Scuro",next:"Prossimo",prev:"Precedente",zoom:"Zoom",slope:"Inclina",fromfullscreen:"Rimpicciolisci",tofullscreen:"Ingrandisci",close:"Chiudi",left:"Sinistra",right:"Destra",toStart:"Alla Partenza",toEnd:"Alla Fine",goToHomelink:"Aprire home page",clickToOpen:"Clicca per aprire",useMousewheel:"Usa la rotellina del mouse",forEasyViewing:"Per visualizzare",askSaveImage:"Selezionare la pagina da salvare, per favore",or:"o"},{lng:"es",save:"Guardar",light:"Claro",dark:"Oscuro",next:"Siguiente",prev:"Anterior",zoom:"Ampliar",slope:"Inclinar",fromfullscreen:"Salir pantalla completa",tofullscreen:"Abrir pantalla completa",close:"Cerrar",left:"Izquierda",right:"Derecha",toStart:"Al principio",toEnd:"Al final",goToHomelink:"Ir a la p\xe1gina principal",clickToOpen:"Pulsa para abrir",useMousewheel:"Usa la rueda del rat\xf3n",forEasyViewing:"Para visualizar",askSaveImage:"Por favor, selecciona la p\xe1gina a guardar",or:"o"},{lng:"en",save:"Save",light:"Light",dark:"Dark",next:"Next",prev:"Prev",zoom:"Zoom",slope:"Slope",fromfullscreen:"Exit full screen",tofullscreen:"Open full screen",close:"Close",left:"Left",right:"Right",toStart:"To start",toEnd:"To end",goToHomelink:"Go to main page",clickToOpen:"Click to open",useMousewheel:"Use mousewheel",forEasyViewing:"For easy viewing",askSaveImage:"Pleae, select page to save",or:"or"}];!function(T){T.onebook=function(t,e,i){var S="ONEBOOK3DGLOBALDATASTORAGE";i=!(!i||i===T||!i.size)&&i;window[S]||(window[S]={FLIPS:{},NUMBER:0,BOOKS:[],CURRENT:!1,SUPERBOOK:!1,SKIN:{},queueBooksBuilding:[],buildNextBook:function(){window[S].buildingNowFlag=!0;var t=window[S].queueBooksBuilding.shift();if(t){if(t.target){var e=T(t.target).attr("onebook3d");if(e&&window[S].BOOKS[e])window[S].BOOKS[e].exit()}T.extend(!0,{},a).init(t.arrSrc,t.options,t.target)}else window[S].buildingNowFlag=!1},GLOSSY:function(){for(var t,e=document.createElement("canvas"),i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],a=0;a<i.length;++a){try{t=e.getContext(i[a])}catch(s){}if(t)break}return null==t?(console.log("NO GL",t),!1):(console.log("YES GL",t),!0)}()});var a={init:function(t,e,i){var a=this;this.IMAGES_SRC=t,this.$TARGET=i,this.startIndex=1e3+20*window[S].NUMBER,this.options=this.set_options_default(e),s.init(T.extend(this.options,{onReady:function(t){a.initWithData(t)}}))},set_options_default:function(t){return T.extend({language:"en",skin:"dark",bgDark:"",bgLight:"",pageColor:"white",border:30,typeAnimation:"",startPage:1,slope:0,flip:"basic",cesh:!0,startWithFullScreen:!1},t||{})},initWithData:function(t){var e=this,i=this.startIndex,a={defineSkin:function(t){return{dark:"dark",light:"light"}[t&&t.toLowerCase()]||"dark"},defineSkinArray:function(t){return"object"!=typeof t?[a.defineSkin(t)]:[a.defineSkin(t[0]),a.defineSkin(t[1])]},defineLanguage:function(t){var e=ONEBOOK3D_ADDITIONAL_LANGUAGES,i={en:0,ru:1};if(e&&0<e.length)for(var a=0;a<e.length;a++)i[e[a].lng]=a+2;return i[t.toLowerCase()]||0},defineBorder:function(t){return(t=parseInt(t,10))<101?t:30},defineSlope:function(t){return(t=parseInt(t,10))<3?t:0}};this.CFG={HOME_LINK:"http://www.onebook3d.riadesign.ru",DIVIDE_IMAGES:!1,PAGE_DEFAULT_COLOR:this.options.pageColor,BORDER:a.defineBorder(this.options.border),ARR_SLOPE_ANGLES:[0,20,40],START_SLOPE_MODE:a.defineSlope(this.options.slope),ROTATE_CENTER_OFFSET:1.7,ROTATE_CENTER_OFFSET_GL:.3,SHEETS_SENSIVITY:8,PASPARTU_BEHAVIORS_PARAM:{width:0,height:80},SPACE_AROUND_STAGE:{horizontal:20,vertical:20},DRAG_PARAM:{px_per_persent:3},NUMBEROF_PRELOAD_SHEETS:3,MAX_SCREEN_SIZE:{width:2e3,height:1200},ICONS_PANEL:{tiny:{height:101,width:265,noTitle:20,betweenIcons:2,pageNumbers:{width:83,fontSize:16}},small:{height:101,width:410,noTitle:20,betweenIcons:8,pageNumbers:{width:102,fontSize:18}},middle:{height:101,width:470,noTitle:20,betweenIcons:6,pageNumbers:{width:92,fontSize:16}},large:{height:140,width:700,noTitle:30,betweenIcons:10,pageNumbers:{width:105,fontSize:16}},titleSection:65,overlay_pr:.8},ICONS_SIZE:{big:50,small:36},MAX_FRAME_DRAGGABLE:60,MAX_MOUSE_SPEED_X:90,ZOOM_WAITER_SIZE:60,LANGUAGE:a.defineLanguage(this.options.language),ZINDEX:{bookBackground:i,bookStage:i+5,bookIconsPanel:i+10,bookSaveMenu:i+20,zoomLayer:i+2e3},GL_DEPTH_STEP:3,FV:window[this.getString([79,78,69,66,79,79,75,51,68,84,72,69,66,69,83,84])]},this.GIF="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",this.AJAX_LOADER="data:image/gif;base64,R0lGODlhHwAfAPUAAP///wAAAOjo6NLS0ry8vK6urqKiotzc3Li4uJqamuTk5NjY2KqqqqCgoLCwsMzMzPb29qioqNTU1Obm5jY2NiYmJlBQUMTExHBwcJKSklZWVvr6+mhoaEZGRsbGxvj4+EhISDIyMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAHwAfAAAG/0CAcEgUDAgFA4BiwSQexKh0eEAkrldAZbvlOD5TqYKALWu5XIwnPFwwymY0GsRgAxrwuJwbCi8aAHlYZ3sVdwtRCm8JgVgODwoQAAIXGRpojQwKRGSDCRESYRsGHYZlBFR5AJt2a3kHQlZlERN2QxMRcAiTeaG2QxJ5RnAOv1EOcEdwUMZDD3BIcKzNq3BJcJLUABBwStrNBtjf3GUGBdLfCtadWMzUz6cDxN/IZQMCvdTBcAIAsli0jOHSJeSAqmlhNr0awo7RJ19TJORqdAXVEEVZyjyKtE3Bg3oZE2iK8oeiKkFZGiCaggelSTiA2LhxiZLBSjZjBL2siNBOFQ84LxHA+mYEiRJzBO7ZCQIAIfkEAAoAAQAsAAAAAB8AHwAABv9AgHBIFAwIBQPAUCAMBMSodHhAJK5XAPaKOEynCsIWqx0nCIrvcMEwZ90JxkINaMATZXfju9jf82YAIQxRCm14Ww4PChAAEAoPDlsAFRUgHkRiZAkREmoSEXiVlRgfQgeBaXRpo6MOQlZbERN0Qx4drRUcAAJmnrVDBrkVDwNjr8BDGxq5Z2MPyUQZuRgFY6rRABe5FgZjjdm8uRTh2d5b4NkQY0zX5QpjTc/lD2NOx+WSW0++2RJmUGJhmZVsQqgtCE6lqpXGjBchmt50+hQKEAEiht5gUcTIESR9GhlgE9IH0BiTkxrMmWIHDkose9SwcQlHDsOIk9ygiVbl5JgMLuV4HUmypMkTOkEAACH5BAAKAAIALAAAAAAfAB8AAAb/QIBwSBQMCAUDwFAgDATEqHR4QCSuVwD2ijhMpwrCFqsdJwiK73DBMGfdCcZCDWjAE2V347vY3/NmdXNECm14Ww4PChAAEAoPDltlDGlDYmQJERJqEhGHWARUgZVqaWZeAFZbERN0QxOeWwgAAmabrkMSZkZjDrhRkVtHYw+/RA9jSGOkxgpjSWOMxkIQY0rT0wbR2LQV3t4UBcvcF9/eFpdYxdgZ5hUYA73YGxruCbVjt78G7hXFqlhY/fLQwR0HIQdGuUrTz5eQdIc0cfIEwByGD0MKvcGSaFGjR8GyeAPhIUofQGNQSgrB4IsdOCqx7FHDBiYcOQshYjKDxliVDpRjunCjdSTJkiZP6AQBACH5BAAKAAMALAAAAAAfAB8AAAb/QIBwSBQMCAUDwFAgDATEqHR4QCSuVwD2ijhMpwrCFqsdJwiK73DBMGfdCcZCDWjAE2V347vY3/NmdXNECm14Ww4PChAAEAoPDltlDGlDYmQJERJqEhGHWARUgZVqaWZeAFZbERN0QxOeWwgAAmabrkMSZkZjDrhRkVtHYw+/RA9jSGOkxgpjSWOMxkIQY0rT0wbR2I3WBcvczltNxNzIW0693MFYT7bTumNQqlisv7BjswAHo64egFdQAbj0RtOXDQY6VAAUakihN1gSLaJ1IYOGChgXXqEUpQ9ASRlDYhT0xQ4cACJDhqDD5mRKjCAYuArjBmVKDP9+VRljMyMHDwcfuBlBooSCBQwJiqkJAgAh+QQACgAEACwAAAAAHwAfAAAG/0CAcEgUDAgFA8BQIAwExKh0eEAkrlcA9oo4TKcKwharHScIiu9wwTBn3QnGQg1owBNld+O72N/zZnVzRApteFsODwoQABAKDw5bZQxpQ2JkCRESahIRh1gEVIGVamlmXgBWWxETdEMTnlsIAAJmm65DEmZGYw64UZFbR2MPv0QPY0hjpMYKY0ljjMZCEGNK09MG0diN1gXL3M5bTcTcyFtOvdzBWE+207pjUKpYrL+wY7MAB4EerqZjUAG4lKVCBwMbvnT6dCXUkEIFK0jUkOECFEeQJF2hFKUPAIkgQwIaI+hLiJAoR27Zo4YBCJQgVW4cpMYDBpgVZKL59cEBhw+U+QROQ4bBAoUlTZ7QCQIAIfkEAAoABQAsAAAAAB8AHwAABv9AgHBIFAwIBQPAUCAMBMSodHhAJK5XAPaKOEynCsIWqx0nCIrvcMEwZ90JxkINaMATZXfju9jf82Z1c0QKbXhbDg8KEAAQCg8OW2UMaUNiZAkREmoSEYdYBFSBlWppZl4AVlsRE3RDE55bCAACZpuuQxJmRmMOuFGRW0djD79ED2NIY6TGCmNJY4zGQhBjStPTFBXb21DY1VsGFtzbF9gAzlsFGOQVGefIW2LtGhvYwVgDD+0V17+6Y6BwaNfBwy9YY2YBcMAPnStTY1B9YMdNiyZOngCFGuIBxDZAiRY1eoTvE6UoDEIAGrNSUoNBUuzAaYlljxo2M+HIeXiJpRsRNMaq+JSFCpsRJEqYOPH2JQgAIfkEAAoABgAsAAAAAB8AHwAABv9AgHBIFAwIBQPAUCAMBMSodHhAJK5XAPaKOEynCsIWqx0nCIrvcMEwZ90JxkINaMATZXfjywjlzX9jdXNEHiAVFX8ODwoQABAKDw5bZQxpQh8YiIhaERJqEhF4WwRDDpubAJdqaWZeAByoFR0edEMTolsIAA+yFUq2QxJmAgmyGhvBRJNbA5qoGcpED2MEFrIX0kMKYwUUslDaj2PA4soGY47iEOQFY6vS3FtNYw/m1KQDYw7mzFhPZj5JGzYGipUtESYowzVmF4ADgOCBCZTgFQAxZBJ4AiXqT6ltbUZhWdToUSR/Ii1FWbDnDkUyDQhJsQPn5ZU9atjUhCPHVhgTNy/RSKsiqKFFbUaQKGHiJNyXIAAh+QQACgAHACwAAAAAHwAfAAAG/0CAcEh8JDAWCsBQIAwExKhU+HFwKlgsIMHlIg7TqQeTLW+7XYIiPGSAymY0mrFgA0LwuLzbCC/6eVlnewkADXVECgxcAGUaGRdQEAoPDmhnDGtDBJcVHQYbYRIRhWgEQwd7AB52AGt7YAAIchETrUITpGgIAAJ7ErdDEnsCA3IOwUSWaAOcaA/JQ0amBXKa0QpyBQZyENFCEHIG39HcaN7f4WhM1uTZaE1y0N/TacZoyN/LXU+/0cNyoMxCUytYLjm8AKSS46rVKzmxADhjlCACMFGkBiU4NUQRxS4OHijwNqnSJS6ZovzRyJAQo0NhGrgs5bIPmwWLCLHsQsfhxBWTe9QkOzCwC8sv5Ho127akyRM7QQAAOwAAAAAAAAAAAA==",this.SRC_ICONS_BIG="data:image/png;base64,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",this.SRC_ICONS_MINI="data:image/png;base64,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",this.SRC_HOME_LINK="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAeCAYAAABE4bxTAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACG0lEQVR4nO2WTyhlcRTHD1n4lzIlTQ2lsJCReMkMCtGUjYXsZjGbKavJYhaKrGhqLG1kKaVRSqKsZKOIhfHv6SVmUrOippmUxYjv1zkvr+ve7nW9pOae+nTfve/ec77n/O7t9xWJ4nGR9dzyxsEoeJkmITEwDg68bsgMkOQHWAbToDGEiCLQD76DYbACrkPkuY1dO1L4O7AANkCv+DdTJ9oEc3wGxS5570WG43xH7tTniS7VDEiILt86yAeDoB6MgDlHjhLwBZSKLjdzNoAKUA4qwRvLWQh+gxovQVT+OuWca/0RVFuiZhO0Zv81WVLecwK6wZjoJAus8B9rJGEcgyXLea+m39t+ZcXXUq7lWqFW8Er0HdkEP206f63Rb+ATuHTJG/gdcq6t51qnBCf03op0SbAPZdfjd1oEJeMhX46noCDdPGlEgvwiEuQXkSC/iAT5hZ8g7lt9IDtN9egeBkQ36FCC3opumNtgCLwIISLppebBouhmGwv6sNfexY7o+mg5JkGZyz3OvYxT5W6/J2rUGoLUdNqPM1GrmWMFaJ7iJmQfdIpObdYSfQWHjhzM2WdipkCbNVQramHpgzj15LR/pT7sNGjOoLWosiQ80lPzvaKNpe9pB6uiDpLn9EkTYEvUjMWMI2t0xxo5BeduBf0EuQWXgk6xBXSILh+vsWNOmA6RU10xsRTxL0Sd0EGr+gFcgB7RCUbx/8QNBj9rFr9f954AAAAASUVORK5CYII=",this.SRC_HELP_ARROW="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAAaCAYAAAAT6cSuAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAByklEQVR4nO2XOUtDQRSFryKiQUURSVxQERcQ10qwEhEULKwsUoudP8FGLS0tBAs7xUJE0NrCykIRcSmMjVjEfQVRweUc7oQEMQmEN04IOfDx3iTzZs7cmbnznkhWaacC1wZsaQjcgFrXRmyIs3YIdkG+Yy9W1AiewKJrI7Y0DD7BuGsjtjQD3kGPayM2lAs2QRgEHHuxohIQAjuSoQmmGbyABddGbGlE4iQYrt1R0PbfjjzWpPyRYErBJfgG12AVTIj7wTLorSAIZsEWuAXzCeofgDkW8syPj6AKdIB+0AemQRl4BSfmoSPRt4Mz0Qz14cEA6KFS9HWKe4cHdAtoMvc+0w897IM1sBGnrW7TxhILOUk67QKdojPYLjr4ipg6d6KDvBCNKHVlrl/gAZSbMk0Wm3aZtv2GyP8UA8nAhQynEg1qskBycvZM3UH2n2hw8URDdaBaNOKRa0CiK8H/65k30dcliqvkXjQIJBzDeQp+qCKwDQpF99tziu2knbjP1kW/FOrdWvFeTDTMkL2ujXitMdEMH3RtxGsxq3PGplwb8VoNopl6RXTPZYyYGY9Fv8R9jr14rmXRzFjj2ojX4jnKQ3rAtZGsbOoHTqZUb7lFI8sAAAAASUVORK5CYII=",this.GLOSSY=window[S].GLOSSY,this.options.startWithFullScreen&&this.fsapi.goFullScreen(),this.BOOK_INTERNAL=!!this.$TARGET,this.PRE_NAME="OneBook3d_"+Math.floor(1e6*Math.random())+"_",window[S].BOOKS[this.PRE_NAME]=this,window[S].CURRENT=this.PRE_NAME,this.BOOK_INTERNAL||(window[S].SUPERBOOK=this.PRE_NAME),this.SKIN_ARRAY=a.defineSkinArray(this.options.skin);var s=!this.BOOK_INTERNAL&&1<this.SKIN_ARRAY.length?1:0;this.DARK_MODE="light"!==this.SKIN_ARRAY[s],this.addStyle(),this.$gStage=this.getStage(),this.$gContainter=T("#"+this.divNames.book_container),this.$gBookLoader=T("#"+this.divNames.book_loader),this.$gGlossyContainter=T("#"+this.divNames.glossy_container),this.LNG={save:["Save","\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"],light:["Light","\u0421\u0432\u0435\u0442\u043b\u044b\u0439"],dark:["Dark","\u0422\u0435\u043c\u043d\u044b\u0439"],prev:["Prev","\u041d\u0430\u0437\u0430\u0434"],next:["Next","\u0414\u0430\u043b\u0435\u0435"],zoom:["Zoom","\u041c\u0430\u0441\u0448\u0442\u0430\u0431"],zoomclose:["Zoom","\u041c\u0430\u0441\u0448\u0442\u0430\u0431"],slope:["Slope","\u041d\u0430\u043a\u043b\u043e\u043d"],fromfullscreen:["Smaller","\u0423\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c"],tofullscreen:["Larger","\u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c"],close:["Close","\u0417\u0430\u043a\u0440\u044b\u0442\u044c"],left:["Left","\u0421\u043b\u0435\u0432\u0430"],right:["Right","\u0421\u043f\u0440\u0430\u0432\u0430"],toStart:["To start","\u0412 \u043d\u0430\u0447\u0430\u043b\u043e"],toEnd:["To end","\u0412 \u043a\u043e\u043d\u0435\u0446"],hlpGoToHomelink:["Open homepage","\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0434\u043e\u043c\u0430\u0448\u043d\u044e\u044e \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443"],hlpClickToOpen:["Click to open","\u041e\u0442\u043a\u0440\u043e\u0439 \u043c\u0435\u043d\u044f"],hlpUseMousewheel:["Use mouse wheel<br>for easy viewing","\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u043a\u043e\u043b\u0435\u0441\u043e \u043c\u044b\u0448\u0438<br>\u0434\u043b\u044f \u043b\u0438\u0441\u0442\u0430\u043d\u0438\u044f"],hlpUseMousewheelGL:[["Use mouse wheel","for easy viewing"],["\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u043a\u043e\u043b\u0435\u0441\u043e","\u043c\u044b\u0448\u0438 \u0434\u043b\u044f \u043b\u0438\u0441\u0442\u0430\u043d\u0438\u044f"]],askSaveImage:["Select the page to save, please","\u041a\u0430\u043a\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c?"],askSaveLinks:['<a href="#">Left</a> or <a href="#">Right</a>','<a href="#">\u041b\u0435\u0432\u043e\u0435</a> \u0438\u043b\u0438 <a href="#">\u041f\u0440\u0430\u0432\u043e\u0435</a>']};var n=ONEBOOK3D_ADDITIONAL_LANGUAGES;if(n&&0<n.length)for(var o=0;o<n.length;o++)this.LNG.save.push(n[o].save),this.LNG.light.push(n[o].light),this.LNG.dark.push(n[o].dark),this.LNG.prev.push(n[o].prev),this.LNG.next.push(n[o].next),this.LNG.zoom.push(n[o].zoom),this.LNG.zoomclose.push(n[o].zoom),this.LNG.slope.push(n[o].slope),this.LNG.fromfullscreen.push(n[o].fromfullscreen),this.LNG.tofullscreen.push(n[o].tofullscreen),this.LNG.close.push(n[o].close),this.LNG.left.push(n[o].left),this.LNG.right.push(n[o].right),this.LNG.toStart.push(n[o].toStart),this.LNG.toEnd.push(n[o].toEnd),this.LNG.hlpGoToHomelink.push(n[o].goToHomelink),this.LNG.hlpClickToOpen.push(n[o].clickToOpen),this.LNG.hlpUseMousewheel.push(n[o].useMousewheel+"<br>"+n[o].forEasyViewing),this.LNG.hlpUseMousewheelGL.push([n[o].useMousewheel,n[o].forEasyViewing]),this.LNG.askSaveImage.push(n[o].askSaveImage),this.LNG.askSaveLinks.push('<a href="#">'+n[o].left+"</a> "+n[o].or+' <a href="#">'+n[o].right+"</a>");this.BTNS_OFFSET={save:[["-10000px"]],skin:[["-50px","0px"],["dark","light"],"DARK_MODE"],prev:[["-150px"]],zoom:[["-200px"]],next:[["-250px"]],slope:[["-300px"]],togglebook:[["-350px","-400px"],["toStart","toEnd"],"START_FROM_END"],close:[["-450px"]],zoomclose:[["-450px"]]},this.BTNS_MINI_OFFSET={save:[["-7200px"]],skin:[["-36px","0px"],["dark","light"],"DARK_MODE"],prev:[["-108px"]],zoom:[["-144px"]],next:[["-180px"]],slope:[["-216px"]],tofullscreen:[["-252px"]],fromfullscreen:[["-288px"]],togglebook:[["-324px","-360px"],["toStart","toEnd"],"START_FROM_END"],close:[["-396px"]],zoomclose:[["-396px"]]},this.PANEL_TYPE="",this.LARGE_ICONS=!1,this.FRDATA=t,this.FIRST_FRAME=0,this.ARR_PAGES_SRC=[],this.ARR_PAGES_TITLE=[],this.getSrcAndTitles(this.IMAGES_SRC),!this.CFG.DIVIDE_IMAGES&&0<this.ARR_PAGES_SRC.length%2&&this.ARR_PAGES_SRC.push(this.CFG.PAGE_DEFAULT_COLOR),this.START_FROM_END=0,this.START_PAGE=this.options.startPage,this.GSCALE=1,this.ALL_PAGES_MAP=[],this.ALLSHEETS=[],this.$ARR_SHEETS=[],this.GL_ARR_SHEETS=[],this.FIRST_IMAGE_SIZE={w:0,h:0},this.SHEETS_WAS_BUILT=[],this.SHEET_DISPLAYED=null,this.QUEUE_IMAGES_LOADED=[],this.IMG_NOW_LOADING=[],this.NOW_LOADING_COUNTER=0,this.IMG_NOW_LOADING_FOR_ZOOM=[],this.options.cesh||this.addCeshNames(Math.floor(1e4*Math.random())),this.ANIMATION_SLOPE=!1,this.ZOOM_MODE=0,this.STAGE={width:0,height:0},this.STAGE_CENTER={top:0,left:0},this.STAGE_BOUNDING_BOX={width:0,height:0,top:0,left:0},this.MAX_BOUNDS={width:0,height:0,top:0,left:0},this.ENVIRON=this.getEnviron();var r={prepareAndStart:function(){!e.BOOK_INTERNAL&&e.build_background(),e.prepareBookSize(),e.prepareIconsPanelSize(),e.prepareSkinImages(function(){e.findBookSizeByFirstImage(function(){e.fit3dDataToBookSize()})})}},h=this.options.startWithFullScreen?1e3:100;setTimeout(function(){r.prepareAndStart()},h)},prepareBookSize:function(){this.WINSIZE={width:T(window).width(),height:T(window).height()},this.TARGETSIZE=!!this.$TARGET&&{left:this.$TARGET.offset().left,top:0,width:this.$TARGET.width(),height:100},this.ZOOMSIZE={height:this.WINSIZE.height,width:this.WINSIZE.width,top:0,left:0}},getString:function(t){for(var e="",i=0;i<t.length;i++)e+=t[i]?String.fromCharCode(t[i]):" ";return e},prepareIconsPanelSize:function(){var t=this.CFG.ICONS_PANEL,e=this.$TARGET?this.TARGETSIZE:this.WINSIZE;if(this.BOOK_INTERNAL){if(e.width<t.tiny.width)return!1;e.width<t.small.width?(this.LARGE_ICONS=!1,this.PANEL_TYPE="tiny"):(this.LARGE_ICONS=!1,this.PANEL_TYPE="small")}else if(this.fsapi.isFullScreen()){if(e.width<t.large.width)return!1;this.LARGE_ICONS=!0,this.PANEL_TYPE="large"}else{if(e.width<t.middle.width)return!1;this.LARGE_ICONS=!1,this.PANEL_TYPE="middle"}},getTotalSheets:function(){return this.ALLSHEETS.length},getEnviron:function(){var t=navigator.userAgent,e=-1!=t.indexOf("Chrome"),i=-1!=t.indexOf("Safari"),a=-1!=t.indexOf("OPR"),s=-1!=t.indexOf("WebKit"),n={ios:-1!=navigator.userAgent.indexOf("iP"),android:-1!=navigator.userAgent.indexOf("Android"),firefox:-1!=navigator.userAgent.indexOf("Firefox"),windows:-1!=navigator.userAgent.indexOf("Windows"),mac:-1!=navigator.userAgent.indexOf("Macintosh"),webkit:s,safari:i&&!e,chrome:i&&e&&!a,opera:a,ipad:-1!=navigator.userAgent.indexOf("iPad"),iphone:-1!=navigator.userAgent.indexOf("iPhone")};return n.touch=n.ios||n.android,n},getSrcAndTitles:function(t){t=t.slice()||[];var e=0;if(this.NO_ONE_TITLES=!0,t.length){for(var i=0,a=t.length;i<a;i++)"string"==typeof t[i]?(this.ARR_PAGES_SRC.push(t[i]),this.ARR_PAGES_TITLE.push("")):"object"==typeof t[i]&&2==t[i].length&&(e++,this.ARR_PAGES_SRC.push(t[i][0]),this.ARR_PAGES_TITLE.push(t[i][1]));this.NO_ONE_TITLES=!e}},addStyle:function(){var i=this,t=this.PRE_NAME;this.divNames={background:t+"background",book_stage:t+"stage",book_help_layer:t+"help_layer",book_container:t+"stage_container",glossy_container:t+"glossy_container",book_loader:t+"book_loader",book_icons_panel:t+"icons_panel",book_spread_title:t+"spread_title",book_page_numbers:t+"page_numbers",icons_container:t+"icons_container",zoom_layer:t+"zoom_layer",zoom_content:t+"zoom_content",zoom_title_spread:t+"zoom_title_spread",zoom_behavior_section:t+"zoom_behavior_section",zoom_buttons:t+"zoom_buttons",zoom_waiter:t+"zoom_waiter_layer",save_menu:t+"save_menu"};var e=function(t){var e=document.createElement("style");e.type="text/css",e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t)),i.CSS=document.getElementsByTagName("head")[0].appendChild(e)},a="#"+this.divNames.background,s="#"+this.divNames.book_stage,n="#"+this.divNames.book_container,o="#"+this.divNames.glossy_container,r="#"+this.divNames.book_help_layer,h="#"+this.divNames.book_loader,d="."+this.divNames.book_spread_title,l="#"+this.divNames.book_page_numbers,g="#"+this.divNames.book_icons_panel,p="#"+this.divNames.zoom_layer,A="."+this.divNames.zoom_content,c="."+this.divNames.zoom_title_spread,f="#"+this.divNames.zoom_waiter;saveMenu="."+this.divNames.save_menu;var E=this.CFG.ZINDEX,S="";S+=p+"{position:relative;}\n",S+=p+" .btn_title{font:12px arial;color:black;padding:5px;white-space:nowrap;}\n",S+=A+"{overflow:hidden;text-align:center;background:#e5e5e5;}\n",S+=A+" .zoom_pages{border-collapse:collapse;border:0px;background:white;}\n",S+=A+" .zoom_pages td{padding:0px;}\n",S+=c+"{border-top:1px solid white;}\n",S+=c+" p{font:14px arial;color:black;line-height:140%;margin:0px;}\n",S+=c+" p span{font:bold 14px arial;color:gray;margin-right:8px;}\n",S+=saveMenu+" h1{font:16px arial;color:white;}\n",S+=saveMenu+" p{font:16px arial;color:white;}\n",S+=saveMenu+" a{font:16px arial;color:white;}\n",S+=l+"{color:#b2b2b2;}\n",S+=l+".light{color:#555555;}\n",S+=[s+"{","position:absolute;left:0px;top:0px;","overflow:hidden;","-webkit-perspective:1000px;","-moz-perspective:1000px;","-ms-perspective:1000px;","perspective:1000px;","z-index:"+E.bookStage+";}\n"].join(""),S+=[s+".pointer:hover{","cursor:pointer;}\n"].join(""),S+=[a+"{","position:fixed;left:0px;top:0px;right:0px;bottom:0px;",this.options.bgDark?"background:"+this.options.bgDark+";":"background:#282828;","z-index:"+E.bookBackground+";}\n"].join(""),S+=[a+".light{",this.options.bgLight?"background:"+this.options.bgLight+";":"background:#d0d0d0;",";}\n"].join(""),S+=[n+"{","width:100%; height:100%;","top:0px;left:0px;position:absolute;","-webkit-transform-style: preserve-3d;","-moz-transform-style: preserve-3d;","-ms-transform-style: preserve-3d;","transform-style: preserve-3d;","z-index:20;}\n"].join(""),S+=[o+"{","width:100%; height:100%;","top:0px;left:0px;position:absolute;","z-index:25;}\n"].join(""),S+=[n+" div{","height:300px;","-webkit-transform-origin:left center;","-moz-transform-origin:left center;","-ms-transform-origin:left center;",
"transform-origin:left center;","-webkit-transform-style: preserve-3d;","-ms-transform-style: preserve-3d;","-moz-transform-style: preserve-3d;","transform-style: preserve-3d;}\n"].join(""),S+=[n+" .all_edges{","perspective:5000px;transform-origin:left center;transform-style: preserve-3d;","-moz-perspective:5000px;-moz-transform-origin:left center;-moz-transform-style: preserve-3d;","-ms-perspective:5000px;-ms-transform-origin:left center;-ms-transform-style: preserve-3d;","}\n"].join(""),S+=[n+" .wholeimage{","-webkit-transform-origin:left center;transform-origin:left center;-moz-transform-origin:left center;-ms-transform-origin:left center;","-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-moz-transform-style: preserve-3d;-ms-transform-style: preserve-3d;","font:bold 20px arial;color:white;}\n"].join(""),S+=[n+" .wholeimage,",n+" .wholeimage span,",n+" .wholeimage div{","}\n"].join(""),S+=[n+" div .back, \n",n+" div .front, \n",n+" .front_image, \n",n+" .front_image>div, \n",n+" .back_image, \n",n+" .back_image>div {","-moz-transform-style: preserve-3d;","-ms-transform-style: preserve-3d;","display:block;width:100%;height:100%;","top:0px;left:0px;position:absolute;","-webkit-backface-visibility: hidden;","-ms-backface-visibility: hidden;","-moz-backface-visibility: hidden;","backface-visibility: hidden;}\n"].join(""),S+=[r+"{","position:absolute;","outline: 1px solid transparent;","-webkit-transform:translate3d(0px,0px,-1px);","-moz-transform:translate3d(0px,0px,-1px);","-ms-transform:translate3d(0px,0px,-1px);","transform:translate3d(0px,0px,-1px);","z-index:0;}\n"].join(""),S+=r+" a {text-decoration:none;}",S+=r+" a:hover {text-decoration:underline;}",S+=r+" p {padding:20px 20px 20px 0px;margin:0px;}",S+=r+" p span{display:block;margin-top:10px;}",S+=r+" .hlpLeftSide {border:1px solid #cccccc;border-right:none;}\n",S+=r+" .hlpRightSide {border:1px solid #cccccc;border-left:none;}\n",S+=r+" .hlpLeftSide p span[name=home_link]{width:36px;height:30px;margin:10px 0px 0px auto;opacity:0.8;}",S+=r+" .hlpLeftSide p span[name=click_to_open] a{font:21px arial;color:white;}",S+=r+" .hlpLeftSide p span[name=use_mousewheel]{font:12px arial;color:#d4d4d4;}",S+=r+" .hlpLeftSide p span[name=help_arrow]{width:55px;height:26px;margin:10px 0px 0px auto;opacity:0.8;}",S+=r+" .hlpRightSide p span[name=goto_start] a{font:18px arial;color:white;}",S+=r+" p.middleSize {padding:10px 10px 10px 0px;}",S+=r+" p.middleSize span{margin-top:5px;}",S+=r+" .hlpLeftSide p.middleSize span[name=click_to_open] a{font:16px arial;}",S+=r+" .hlpRightSide p.middleSize span[name=goto_start] a{font:14px arial;}",S+=r+".light .hlpLeftSide {border:1px solid #bfbfbf;border-right:none;}\n",S+=r+".light .hlpRightSide {border:1px solid #bfbfbf;border-left:none;}\n",S+=r+".light .hlpLeftSide p span[name=home_link]{opacity:0.4;}",S+=r+".light .hlpLeftSide p span[name=click_to_open] a{color:#656565;}",S+=r+".light .hlpLeftSide p span[name=use_mousewheel]{color:#656565;}",S+=r+".light .hlpLeftSide p span[name=help_arrow]{opacity:0.4;}",S+=r+".light .hlpRightSide p span[name=goto_start] a{color:#656565;}",S+=[h+"{",'background:white url("'+this.AJAX_LOADER+'") center no-repeat;',"position:absolute;top:0px;left:0px;width:90px;height:90px;","-moz-border-radius:15px;","border-radius:15px;","opacity:0.5;display:none;","z-index:100;}\n"].join(""),S+=[f+"{","position:absolute;","width:100px;height:100px;","left:0px;top:0px;","z-index:300;}\n"].join(""),S+=[g+"{","position:absolute;","top:0px;left:0px;text-align:center;","z-index:"+E.bookIconsPanel+";}\n"].join(""),S+=g+" "+d+" p{font:14px arial;color:#aaaaaa;line-height:140%;margin:0px;}\n",S+=g+" "+d+" span{font:bold 14px arial;color:#ffffff;margin-right:8px;}\n",S+=g+".light "+d+" p{color:#000000;}\n",S+=g+".light "+d+" span{color:#888888;}\n",S+=g+" .btn_title{font:12px arial;color:#ffffff;padding:5px;white-space:nowrap;}\n",S+=g+".light .btn_title{color:black;}\n",S+=[".unselectable{","-webkit-user-select:none;","-khtml-user-select:none;","-moz-user-select:none;","user-select: none;}\n"].join(""),e(S+=[".noPointerEvents{","pointer-events:none;}\n"].join(""))},getStage:function(){var t=this.divNames.book_stage,e=this.divNames.book_container,i=this.divNames.glossy_container,a=this.divNames.book_loader,s=this.divNames.zoom_waiter,n=T("#"+t);n.size()&&n.remove();var o=['<div id="'+t+'">','<div id="'+e+'"></div>',this.GLOSSY?'<div id="'+i+'" style="pointer-events:none;"></div>':"",'<div id="'+a+'" style="display:none;"></div>','<div id="'+s+'" style="display:none;"></div>',"</div>"].join("");return T("body").append(o),T("#"+t)},getGlStage:function(){var t={},e=this.$gStage.width(),i=this.$gStage.height();this.$gGlossyContainter.css({width:e,height:i}),t.container=document.getElementById(this.divNames.glossy_container),t.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),t.renderer.setSize(e,i),t.container.appendChild(t.renderer.domElement),t.scene=new THREE.Scene;var a=e/i;return t.bookBase=new THREE.Object3D,t.bookBase.position.y=-this.CFG.BOOK_GL_SIZE.height*this.CFG.ROTATE_CENTER_OFFSET_GL,t.scene.add(t.bookBase),t.camera=new THREE.PerspectiveCamera(74.25/a,a,.1,3e3),t.camera.position.z=1200,t.camera.position.y=0,t.scene.add(t.camera),t},bookHide:function(){this.$gStage.hide(),this.$gIconsPanel&&this.$gIconsPanel.hide()},bookShow:function(){this.$gStage.show(),this.$gIconsPanel&&this.$gIconsPanel.show()},bgLoaderShow:function(t){var e=this.$gBookBackground&&this.$gBookBackground.find("div");t?e&&e.is(":hidden")&&e.show():e&&e.is(":visible")&&e.hide()},bookLoaderShow:function(t){t?this.$gBookLoader.is(":hidden")&&this.$gBookLoader.show():this.$gBookLoader.is(":visible")&&this.$gBookLoader.fadeOut()},exit:function(){this.TMR_RESIZE&&(clearTimeout(this.TMR_RESIZE),this.TMR_RESIZE=null),window[S].NUMBER-=1,window[S].SUPERBOOK=!1,delete window[S].BOOKS[this.PRE_NAME],this.zoomOut(),this.$gStage&&this.$gStage.remove(),this.$gSaveMenu&&this.$gSaveMenu.remove(),this.$gIconsPanel&&this.$gIconsPanel.remove(),this.$gBookBackground&&this.$gBookBackground.fadeOut("normal",function(){this.remove()}),this.CSS.remove(),T(window).unbind("."+this.PRE_NAME),T(document).unbind("keyup."+this.PRE_NAME);var r=this.options.parentBook,h=this.CURRENT.spread,d=this.CURRENT.slope_mode;(function(){var t=window[S].BOOKS;for(var e in t)if(t.hasOwnProperty(e)){var i=e===r,a=t[e],s=a.isNeedResizeReposInternal();if(r&&i){var n=h?2*h:1;a.START_PAGE=n,a.slopeToggle(d),window[S].CURRENT=a.PRE_NAME;var o=a.CURRENT.spread!==h;"resize"===s?a.restart():("reposition"===s&&a.restart(s),o&&a.gotoSpread(h))}else s&&a.restart(s)}})()},restart:function(t){if("reposition"===t){var e=this.TARGETSIZE,i=this.STAGE,a=Math.round((e.width-i.width)/2+e.left),s=this.getIconsPanelWidth(),n=Math.round((e.width-s)/2+e.left),o=Math.round((e.width-this.$gSaveMenu.width())/2+e.left);this.$gStage.css({left:a}),this.$gIconsPanel.css({left:n}),this.$gSaveMenu.css({left:o}),this.prepareBookSize(),this.calculateBounds()}else this.zoomOut(),this.GSCALE=1,this.SHEETS_WAS_BUILT=[],this.QUEUE_IMAGES_LOADED=[],this.IMG_NOW_LOADING=[],this.NOW_LOADING_COUNTER=0,this.prepareBookSize(),this.prepareIconsPanelSize(),this.deleteAllGLSheets(),this.fit3dDataToBookSize()},deleteAllGLSheets:function(){if(this.GLOSSY){var t=[];for(var e in this.GL_ARR_SHEETS)t.push(this.GL_ARR_SHEETS[e].num);for(e=0;e<t.length;e++){var i=t[e],a=this.getSheetByIndex(i);a&&(this.gGL.bookBase.remove(a.mesh),delete this.GL_ARR_SHEETS[i])}}},gotoSpread:function(t){var e=this,i=this.getTotalSheets();if(this.GLOSSY&&(e.GL_LINK_TO_START=!1,e.$gStage.removeClass("pointer")),!this.ZOOM_MODE&&!this.ANIMATION_FLAG){0===t?(this.START_FROM_END=!0,this.toggleBook()):t===i?(this.START_FROM_END=!1,this.toggleBook()):(this.CURRENT.spread=t,this.GLOSSY||(this.$gHelpLayer.find(".hlpLeftSide").css({opacity:0}),this.$gHelpLayer.find(".hlpRightSide").css({opacity:0})));var a=this.SHEETS_WAS_BUILT;for(var s in a)a.hasOwnProperty(s)&&this.deleteSheet(s);this.buildAndPreloadSheets(),this.changeSpreadTitle(),this.pageNumbersChange();var n=this.$G_ARR_BUTTONS.togglebook;n&&n.update()}},prepareSkinImages:function(e){var i=this,a=window[S].SKIN,s={invertCanvas:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),a=i.data,s=0;s<a.length;s+=4)a[s]=255-a[s],a[s+1]=255-a[s+1],a[s+2]=255-a[s+2];return e.putImageData(i,0,0),t},cloneCanvas:function(t){var e=document.createElement("canvas"),i=e.getContext("2d");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),e},drawHomeLink:function(){if(a.HOME_LINK)s.drawHelpArrow();else{var t=new Image;t.onload=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height,t.getContext("2d").drawImage(this,0,0,this.width,this.height),a.HOME_LINK={light:t,dark:s.invertCanvas(s.cloneCanvas(t))},s.drawHelpArrow()},t.src=i.SRC_HOME_LINK}},drawHelpArrow:function(){if(a.HELP_ARROW)s.drawIconsBig();else{var t=new Image;t.onload=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height,t.getContext("2d").drawImage(this,0,0,this.width,this.height),a.HELP_ARROW={light:t,dark:s.invertCanvas(s.cloneCanvas(t))},s.drawIconsBig()},t.src=i.SRC_HELP_ARROW}},drawIconsBig:function(){if(a.ICONS)s.drawIconsMini();else{var t=new Image;t.onload=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height,t.getContext("2d").drawImage(this,0,0,this.width,this.height),a.ICONS={light:t,dark:s.invertCanvas(s.cloneCanvas(t))},s.drawIconsMini()},t.src=i.SRC_ICONS_BIG}},drawIconsMini:function(){if(a.ICONS_MINI)e&&e();else{var t=new Image;t.onload=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height,t.getContext("2d").drawImage(this,0,0,this.width,this.height),a.ICONS_MINI={light:t,dark:s.invertCanvas(s.cloneCanvas(t))},e&&e()},t.src=i.SRC_ICONS_MINI}}};s.drawHomeLink()},getIconsPanelWidth:function(){return this.CFG.ICONS_PANEL[this.PANEL_TYPE].width},getIconsPanelHeight:function(){var t=this.CFG.ICONS_PANEL,e=t[this.PANEL_TYPE].height,i=t[this.PANEL_TYPE].noTitle,a=t.titleSection;return this.NO_ONE_TITLES?e-a+i:e},fsapi:{goFullScreen:function(t){var e=t?document.getElementById(t):document.documentElement;(e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen).call(e)},exitFullScreen:function(){var t=document;(t.exitFullscreen||t.webkitCancelFullScreen||t.webkitExitFullScreen||t.webkitExitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen).call(t)},isFullScreen:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.msFullscreenElement}},buildIconsPanel:function(){var i=this,a=this.CFG.ICONS_PANEL,t=(this.STAGE,this.CFG.BOOK_SIZE,this.divNames.book_icons_panel),s=this.divNames.icons_container,n=this.divNames.book_spread_title,e=this.DARK_MODE?"":" light",o={build:function(){if(i.NO_ONE_TITLES){var t=a[r].noTitle;return l=T(['<table cellpadding="0" cellspacing="0" width="100%" align="center" border=0>','<tr><td height="'+t+'px" style="font-size:0;line-height:0;"><img width="1px" height="1px" src="'+i.GIF+'"></td></tr>','<tr><td><div class="'+s+'" style="position:relative;"></div></td></tr>',"</table>"].join(""))}var e=i.CFG.ICONS_PANEL.titleSection;return l=T(['<table cellpadding="0" cellspacing="0" width="100%" align="center" border=0>','<tr><td height="'+e+'px" class="'+n+'">&nbsp;</td></tr>','<tr><td><div class="'+s+'" style="position:relative;"></div></td></tr>',"</table>"].join(""))}},r=this.PANEL_TYPE,h=this.getIconsPanelWidth(),d=this.getIconsPanelHeight();if(r){var l=o.build();(g=T("#"+t)).size()&&g.remove();var g=T('<div id="'+t+'" class="unselectable'+e+'" style="visibility:hidden;"></div>').append(l).css({width:h,height:d});T("body").append(g),this.$gIconsPanel=g,!this.BOOK_INTERNAL&&this.$gIconsPanel.mousewheel&&this.$gIconsPanel.mousewheel(function(){return!1});var p=T('<div style="width:1px;display:table-cell;"><img width="'+a[r].betweenIcons+'px" src="'+this.GIF+'"></div>'),A=g.find("."+s);this.$gSpreadTitle=g.find("."+n);var c={skin:function(){i.$gSaveMenu.hide(),i.ZOOM_MODE||i.toggleSkin()},save:function(){i.ZOOM_MODE||i.saveImagesAs()},next:function(){i.gotoNext()},prev:function(){i.gotoPrev()},zoom:function(){i.$gSaveMenu.hide(),i.ZOOM_MODE||i.zoomIn()},close:function(){i.$gSaveMenu.hide(),i.ZOOM_MODE||(i.fsapi.isFullScreen()?(i.fsapi.exitFullScreen(),setTimeout(function(){i.exit()},700)):i.exit())},fullScreen:function(){if(i.$gSaveMenu.hide(),!i.ZOOM_MODE)if(i.BOOK_INTERNAL){var t=T.extend(i.options,{startPage:i.START_PAGE,parentBook:i.PRE_NAME,slope:i.CURRENT.slope_mode});T.onebook(i.IMAGES_SRC,t)}else i.fsapi.isFullScreen()?i.fsapi.exitFullScreen():(i.bookHide(),i.bgLoaderShow(!0),i.fsapi.goFullScreen())},slope:function(){i.$gSaveMenu.hide(),i.ZOOM_MODE||i.slopeAnimate()},toggleBook:function(){i.$gSaveMenu.hide(),i.toggleBook()}},f=i.fsapi.isFullScreen()?"fromfullScreen":"tofullScreen";if("tiny"===r)(S=this.cloneIconsSet()).find(">div").append(this.buttonCreate("Prev",c.prev)).append(p.clone()),S.find(">div").append(this.buttonCreate("Save",c.save)).append(p.clone()),S.find(">div").append(this.pageNumbersCreate(r)).append(p.clone()),S.find(">div").append(this.buttonCreate("Slope",c.slope)).append(p.clone()),S.find(">div").append(this.buttonCreate(f,c.fullScreen)).append(p.clone()),S.find(">div").append(this.buttonCreate("Next",c.next)),A.append(S),l.css({position:"absolute",zIndex:10,top:0,left:h/2-S.width()/2}),this.$gButtonsTitle=g.find(".btn_title");else if("small"===r){(E=this.cloneIconsSet()).find(">div").append(this.buttonCreate("Save",c.save)).append(p.clone()),E.find(">div").append(this.pageNumbersCreate(r)).append(p.clone()),A.append(E.css({"float":"left"})),(S=this.cloneIconsSet()).find(">div").append(this.buttonCreate("Prev",c.prev)).append(p.clone()),S.find(">div").append(this.buttonCreate("Zoom",c.zoom)).append(p.clone()),S.find(">div").append(this.buttonCreate("Next",c.next)),A.append(S),S.css({position:"absolute",zIndex:10,top:0,left:h/2-S.width()/2}),(u=this.cloneIconsSet()).find(">div").append(this.buttonCreate("togglebook",c.toggleBook)).append(p.clone()),u.find(">div").append(this.buttonCreate("Slope",c.slope)).append(p.clone()),u.find(">div").append(this.buttonCreate(f,c.fullScreen)),A.append(u.css({"float":"right"})),this.$gButtonsTitle=g.find(".btn_title")}else if("middle"===r){(E=this.cloneIconsSet()).find(">div").append(this.buttonCreate("Save",c.save)).append(p.clone()),E.find(">div").append(this.buttonCreate("Skin",c.skin)).append(p.clone()),E.find(">div").append(this.pageNumbersCreate(r)).append(p.clone()),A.append(E.css({"float":"left"})),(S=this.cloneIconsSet()).find(">div").append(this.buttonCreate("Prev",c.prev)).append(p.clone()),S.find(">div").append(this.buttonCreate("Zoom",c.zoom)).append(p.clone()),S.find(">div").append(this.buttonCreate("Next",c.next)),A.append(S),S.css({position:"absolute",zIndex:10,top:0,left:h/2-S.width()/2}),(u=this.cloneIconsSet()).find(">div").append(this.buttonCreate("togglebook",c.toggleBook)).append(p.clone()),u.find(">div").append(this.buttonCreate("Slope",c.slope)).append(p.clone()),u.find(">div").append(this.buttonCreate(f,c.fullScreen)),u.find(">div").append(p.clone()).append(this.buttonCreate("Close",c.close)),A.append(u.css({"float":"right"})),this.$gButtonsTitle=g.find(".btn_title")}else if("large"===r){var E,S,u;(E=this.cloneIconsSet()).find(">div").append(this.buttonCreate("Save",c.save)).append(p.clone()),E.find(">div").append(this.buttonCreate("Skin",c.skin)).append(p.clone()),A.append(E.css({"float":"left"})),(S=this.cloneIconsSet()).find(">div").append(this.buttonCreate("Prev",c.prev)).append(p.clone()),S.find(">div").append(this.buttonCreate("Zoom",c.zoom)).append(p.clone()),S.find(">div").append(this.buttonCreate("Next",c.next)),A.append(S),S.css({position:"absolute",zIndex:10,top:0,left:h/2-S.width()/2}),(u=this.cloneIconsSet()).find(">div").append(this.buttonCreate("togglebook",c.toggleBook)).append(p.clone()),u.find(">div").append(this.buttonCreate("Slope",c.slope)),i.$TARGET||u.find(">div").append(p.clone()).append(this.buttonCreate("Close",c.close)),A.append(u.css({"float":"right"})),this.$gButtonsTitle=g.find(".btn_title")}this.changeSpreadTitle(),this.pageNumbersChange()}},getHlpLayerGL:function(){var t=this.DARK_MODE?"dark":"light";return{left:this.gGL&&this.gGL.helpLayers?this.gGL.helpLayers[t].left:"",right:this.gGL&&this.gGL.helpLayers?this.gGL.helpLayers[t].right:""}},toggleSkinHlpLayerGLTo:function(t){this.gGL&&this.gGL.helpLayers&&("dark"===t?(this.gGL.helpLayers.dark.left.material.opacity=0,this.gGL.helpLayers.dark.right.material.opacity=0,this.gGL.helpLayers.light.left.material.opacity=1,this.gGL.helpLayers.light.right.material.opacity=1):(this.gGL.helpLayers.dark.left.material.opacity=1,this.gGL.helpLayers.dark.right.material.opacity=1,this.gGL.helpLayers.light.left.material.opacity=0,this.gGL.helpLayers.light.right.material.opacity=0)),this.startRender()},toggleBook:function(){if(!this.ZOOM_MODE&&!this.ANIMATION_FLAG){if(this.GLOSSY)var t=this.getHlpLayerGL();this.START_FROM_END?(this.START_FROM_END=!1,this.CURRENT.spread=0,this.GLOSSY?t.left&&t.right&&(t.left.material.opacity=1,t.right.material.opacity=0):(this.$gHelpLayer.find(".hlpLeftSide").css({opacity:1}),this.$gHelpLayer.find(".hlpRightSide").css({opacity:0}))):(this.START_FROM_END=!0,this.CURRENT.spread=this.getTotalSheets(),this.GLOSSY?t.left&&t.right&&(t.left.material.opacity=0,t.right.material.opacity=1):(this.$gHelpLayer.find(".hlpLeftSide").css({opacity:0}),this.$gHelpLayer.find(".hlpRightSide").css({opacity:1})));var e=this.SHEETS_WAS_BUILT;for(var i in e)e.hasOwnProperty(i)&&this.deleteSheet(i);this.START_PAGE=2*this.CURRENT.spread?2*this.CURRENT.spread:1,this.buildAndPreloadSheets(),this.changeSpreadTitle(),this.pageNumbersChange(),this.$G_ARR_BUTTONS.togglebook&&this.$G_ARR_BUTTONS.togglebook.update()}},toggleSkin:function(){var e=this,t=T("#"+this.divNames.book_page_numbers),i=this.DARK_MODE?"light":"dark",a=window[S].SKIN,s={btn_update:function(){for(var t in e.$G_ARR_BUTTONS)e.$G_ARR_BUTTONS[t].update()},hlp_update_images:function(){e.GLOSSY||(e.$gHelpLayer.find("span[name=home_link]").css({background:"url("+a.HOME_LINK[i].toDataURL()+") no-repeat center"}),e.$gHelpLayer.find("span[name=help_arrow]").css({background:"url("+a.HELP_ARROW[i].toDataURL()+") no-repeat center"}))}};if(this.GLOSSY)this.getHlpLayerGL();if(this.DARK_MODE){this.DARK_MODE=!1;var n=this.getHlpLayerBgImage();this.$gBookBackground.addClass("light"),t.addClass("light"),this.$gIconsPanel.addClass("light"),this.GLOSSY?this.toggleSkinHlpLayerGLTo("dark"):(this.$gHelpLayer.addClass("light"),this.$gHelpLayer.find(".hlpLeftSide").css({background:"url("+n.toDataURL()+")"}),this.$gHelpLayer.find(".hlpRightSide").css({background:"url("+bgImagetoDataURL()+")"})),s.hlp_update_images(),s.btn_update()}else{this.DARK_MODE=!0;n=this.getHlpLayerBgImage();this.$gBookBackground.removeClass("light"),t.removeClass("light"),this.$gIconsPanel.removeClass("light"),this.GLOSSY?this.toggleSkinHlpLayerGLTo("light"):(this.$gHelpLayer.removeClass("light"),this.$gHelpLayer.find(".hlpLeftSide").css({background:"url("+n.toDataURL()+")"}),this.$gHelpLayer.find(".hlpRightSide").css({background:"url("+n.toDataURL()+")"})),s.hlp_update_images(),s.btn_update()}},cloneIconsSet:function(){return T('<div style="display:table;"><div style="display:table-row"></div></div>').clone()},pageNumbersCreate:function(t){var e=this.divNames.book_page_numbers,i=this.CFG.ICONS_PANEL[t],a=i.pageNumbers.width,s=i.pageNumbers.fontSize,n=this.DARK_MODE?"":'class="light" ';return T(['<div id="'+e+'" '+n,'style="display:table-cell;vertical-align:middle;width:'+a+"px;font:"+s+'px arial;">','<span style=""></span></div>'].join(""))},pageNumbersChange:function(){var t=this.divNames.book_page_numbers,e=this.CURRENT.spread+"&nbsp;/&nbsp;"+this.getTotalSheets();T("#"+t).find("span").html(e)},buttonCreate:function(n,t,e){this.$G_ARR_BUTTONS=this.$G_ARR_BUTTONS?this.$G_ARR_BUTTONS:[];var o=this,i=(n=n.toLowerCase(),e?e.mode:this.DARK_MODE?"dark":"light");if(this.LARGE_ICONS)var a=window[S].SKIN.ICONS,r=this.BTNS_OFFSET,s=['<table width="100%" cellpadding="0" cellspacing="0">','<tr><td height="'+(h=this.CFG.ICONS_SIZE.big)+'px" align="center">','<div class="btn_image" style="width:'+h+"px;height:"+h+'px;" ><img src="'+this.GIF+'"></div>',"</td></tr>",'<tr><td align="center" class="btn_title">-</td></tr></table>'].join("");else{var h;a=window[S].SKIN.ICONS_MINI,r=this.BTNS_MINI_OFFSET,s=['<div class="btn_image" style="width:'+(h=this.CFG.ICONS_SIZE.small)+"px;height:"+h+'px;">','<img src="'+this.GIF+'"></div>',"</div>"].join("")}var d=function(){var t=r[n][0];if(1<t.length)var e=r[n][2],i=o[e]?0:1,a=r[n][0][i],s=r[n][1][i];else a=t,s=n;return{offset:a,lngTitle:o.getLNG(s)}},l=function(t){return(o.DARK_MODE?{start:.7,end:1}:{start:.8,end:.5})[t]},g=d(),p="url("+a[i].toDataURL()+") no-repeat "+g.offset+" 0px",A=T('<div class="book_btn" style="width:'+h+'px;display:table-cell;cursor:pointer;">'+s+"</div>").clone(),c=A.find(".btn_image").css({background:p,opacity:l("end")}).attr({title:g.lngTitle});A.find(".btn_title").html(g.lngTitle);return A.hover(function(){c.css({opacity:l("start")})},function(){c.css({opacity:l("end")})}).mousedown(function(){c.css({backgroundPosition:g.offset+" 1px"})}).mouseup(function(){c.css({backgroundPosition:g.offset+" 0px"}),t&&t(n)}),A.update=function(){var t=d(),e=o.DARK_MODE?"dark":"light",i="url("+a[e].toDataURL()+") no-repeat "+t.offset+" 0px";this.find(".btn_image").css({background:i,opacity:l("end")}).attr({title:t.lngTitle});this.find(".btn_title").html(t.lngTitle)},this.$G_ARR_BUTTONS[n]=A},gotoNext:function(){this.$gSaveMenu.hide(),this.ZOOM_MODE||(this.ANIMATION_FLAG||this.startDrag?this.ORDER_TO_ANIMATE="next":this.isDirectionCorrect("next")&&this.animateSheet("next"))},gotoPrev:function(){this.$gSaveMenu.hide(),this.ZOOM_MODE||(this.ANIMATION_FLAG||this.startDrag?this.ORDER_TO_ANIMATE="prev":this.isDirectionCorrect("prev")&&this.animateSheet("prev"))},zoomIn:function(i){var a=this;if(this.ZOOM_MODE||this.ANIMATE_ZOOM)return!1;this.ANIMATE_ZOOM=!0,this.ZOOM_MODE=1;var e=this.divNames.zoom_layer,t=T("#"+e);t.size()&&t.remove(),this.ZOOMSIZE={height:T(window).height(),width:T(window).width(),top:0,left:0};var s=this.ZOOMSIZE;s.top=T(document).scrollTop();var n=.8,o={width:s.width*n,height:s.height*n};o.top=Math.floor(s.top+(s.height-o.height)/2),o.left=Math.floor(s.left+(s.width-o.width)/2);var r={buildZoomLayer:function(){var t=T('<div id="'+e+'"></div>').css({border:"1px solid white",position:"absolute",top:o.top,left:o.left,width:o.width,height:o.height,cursor:"pointer",opacity:.5,zIndex:a.CFG.ZINDEX.zoomLayer}).click(function(){a.ANIMATE_ZOOM||a.zoomOut()});T("body").append(t),a.$gZoomLayer=T("#"+e),r.animateZoomLayerAppear()},animateZoomLayerAppear:function(){var t=s.width,e=s.height;a.$gZoomLayer.animate({top:s.top,left:s.left,width:t,height:e,opacity:1},200,function(){T(this).css({opacity:0,border:"0px none",background:"#e5e5e5"}).animate({opacity:1},300,function(){a.ANIMATE_ZOOM=!1,a.showZoomContent(i)})})}};r.buildZoomLayer()},showZoomContent:function(o){var h=this,i=(o=o,this.getTotalSheets()),n=this.CURRENT.spread,a=0==n,s=n==i,t=this.ZOOMSIZE,r=250,e=85,d={width:t.width,height:t.height-e,left:t.left,top:t.top},l=a||s?1:2,g={height:this.CFG.BOOK_UNSCALED.height,width:this.CFG.BOOK_UNSCALED.width*l},p=g.width<d.width&&g.height<d.height,A={vertical:(g.height+2*r-d.height)/100,horizontal:(g.width+2*r-d.width)/100},c="",f=this.divNames.zoom_content,E=this.divNames.zoom_behavior_section,S=this.divNames.zoom_title_spread,u=this.divNames.zoom_buttons,m="position:absolute;width:100%;height:"+e+"px;top:"+d.height+"px;left:0px;",R=['<div class="'+f+'" style="width:100%;height:100%;"></div>','<div style="'+m+'z-index:10;background:white;opacity:0.8">&nbsp;</div>','<div style="'+m+'z-index:30;" class="'+u+'">&nbsp;</div>','<div style="position:absolute;width:100%;height:100%;top:0px;left:0px;z-index:20;">','<table width="100%" height="100%" cellspacing="0" cellpadding="0" border="0">','<tr><td colspan=3 align="center" class="'+E+'"></td></tr>','<tr><td align="center" class="'+S+'">'+this.CURRENT.spreadTitle+"</td></tr>","</table>","</div>"].join("");this.$gZoomLayer.html(R);var v=this.$gZoomLayer.find("."+f),_=this.$gZoomLayer.find("."+E).css({height:d.height}),T=(this.$gZoomLayer.find("."+S).css({height:e}),this.$gZoomLayer.find("."+u)),O={buttonsInsert:function(){var t=h.cloneIconsSet();t.append(h.buttonCreate("zoomClose",function(){},{mode:"light"})),T.append(t.css({"float":"right",margin:"8px 8px 0px 0px"}))},calculateCoord:function(t){var e={x:t.x-d.left,y:t.y-d.top},i={vertical:100/(d.height/e.y),horizontal:100/(d.width/e.x)};return{top:A.vertical*i.vertical*-1+r,left:A.horizontal*i.horizontal*-1+r}},moveContent:function(t){c.css({marginTop:t.top+"px",marginLeft:t.left+"px"})},contentToCenter:function(){var t=20,e=parseFloat(c.css("marginLeft"))||0,i=parseFloat(c.css("marginTop"))||0;if(o&&!p)var a=this.calculateCoord(o),s=a.left,n=a.top;else s=(g.width-d.width)/2*-1,n=g.height<d.height?(g.height-d.height)/2*-1:0;O.recurseAnimation(t,0,[e,i],[s,n])},behaviors:function(){var e=this;_.mousemove(function(t){p||O.moveContent(e.calculateCoord({x:t.pageX,y:t.pageY}))}).hover(function(){p||(h.TMR_ZOOMPAGES_ANI&&(clearTimeout(h.TMR_ZOOMPAGES_ANI),h.TMR_ZOOMPAGES_ANI=null),o?o=!1:c.hide().fadeIn("normal"))},function(){o&&(o=!1),O.contentToCenter()})},recurseAnimation:function(s,n,o,r){h.TMR_ZOOMPAGES_ANI=setTimeout(function(){var t=++n/s,e=100*(1-(1-Math.sin(Math.acos(1-t)))),i=o[1]-(o[1]-r[1])/100*e,a=o[0]-(o[0]-r[0])/100*e;c.css({margin:i+"px 0px 0px "+a+"px"}),n<s&&O.recurseAnimation(s,n,o,r)},5)},showEmptyPages:function(){var t=g.height,e="",i=['<table class="zoom_pages" width="'+g.width+'px" height="'+t+'px" style="display:none;"><tr>',e+=a||s?a?'<td class="page_front"></td>':'<td class="page_back"></td>':'<td class="page_back" width="50%"></td><td class="page_front" width="50%"></td>',"</tr></table>"].join("");v.html(i),c=v.find(".zoom_pages"),O.behaviors(),O.insertSelfShadow(),O.choosePageForLoading()},insertSelfShadow:function(){var t=h.SELFSHADOW_UNSCALED,e=c.height();c.find(".page_back").html('<div style="width:100%;height:'+e+"px;background:url("+t.back.toDataURL()+') no-repeat;">&nbsp;</div>'),c.find(".page_front").html('<div style="width:100%;height:'+e+"px;background:url("+t.front.toDataURL()+') no-repeat;">&nbsp;</div>'),c.fadeIn("normal"),O.contentToCenter()},insertImageToZoomPage:function(t){var e="left"==t.side?".page_back":".page_front",i="left"==t.side?n-1:n,a=h.buildResizedImage(h.CFG.BOOK_UNSCALED,1,{img:t.img,page:"left"==t.side?0:1,sheet:i},!1);if(h.CFG.DIVIDE_IMAGES){var s="left"==t.side?0:-1*h.CFG.BOOK_UNSCALED.width;c.find(e).css({background:'url("'+a.toDataURL()+'") '+s+"px 0px no-repeat"})}else c.find(e).css({background:'url("'+a.toDataURL()+'") no-repeat'})},loadImageForZoomPage:function(e,i){if(h.TMR_ZOOM||(h.TMR_ZOOM={}),-1<e.indexOf(".png")||-1<e.indexOf(".jpg")||-1<e.indexOf(".gif")){var t=new Image;t.onload=function(){var t={img:this,src:e,side:i};setTimeout(function(){O.insertImageToZoomPage(t)},10)},h.IMG_NOW_LOADING_FOR_ZOOM.push(t),t.src=e}},choosePageForLoading:function(){if(n)if(n==i){t=2*i-1,e=h.ARR_PAGES_SRC[t];O.loadImageForZoomPage(e,"left")}else{t=2*n-1,e=h.ARR_PAGES_SRC[t];O.loadImageForZoomPage(e,"left");t=2*n,e=h.ARR_PAGES_SRC[t];O.loadImageForZoomPage(e,"right")}else{var t=0,e=h.ARR_PAGES_SRC[t];O.loadImageForZoomPage(e,"right")}}};O.buttonsInsert(),O.showEmptyPages()},zoomOut:function(){if(!this.ZOOM_MODE)return!1;this.ZOOM_MODE=0,this.$gZoomLayer&&this.$gZoomLayer.remove()},rotate_x_to:function(t){this.GLOSSY&&this.gGL&&(this.gGL.bookBase.rotation.x=t*Math.PI/180*-1,this.startRender());var e="translate3d("+this.OFFSET.left+"px,"+this.OFFSET.top+"px,0px) rotateX("+t+"deg)";this.$gContainter.css({transform:e,"-webkit-transform":e,"-moz-transform":e,"-ms-transform":e})},slopeAnimate:function(){var t=this;if(this.ANIMATION_SLOPE)return!1;this.ANIMATION_SLOPE=!0;var e=this.CFG.ARR_SLOPE_ANGLES.length,i=t.CURRENT.slope_mode,a=this.CFG.ARR_SLOPE_ANGLES[i];this.CURRENT.slope_mode=i+1<e?i+1:0,this.CFG.START_SLOPE_MODE=this.CURRENT.slope_mode;var s=this.CFG.ARR_SLOPE_ANGLES[this.CURRENT.slope_mode],n=a<s?1:-1,o=function(){a+=n,setTimeout(function(){a!=s?(t.rotate_x_to(a),o()):(t.rotate_x_to(a),t.ANIMATION_SLOPE=!1)},10)};o()},slopeAnimateTo:function(t){var e=this;if(this.ANIMATION_SLOPE)return!1;this.ANIMATION_SLOPE=!0;var i=this.CFG.ARR_SLOPE_ANGLES.length,a=e.CURRENT.slope_mode,s=this.CFG.ARR_SLOPE_ANGLES[a];if("up"===t){if(!(a+1<i))return e.ANIMATION_SLOPE=!1;this.CURRENT.slope_mode=a+1}else{if(!(0<a))return e.ANIMATION_SLOPE=!1;this.CURRENT.slope_mode=a-1}this.CFG.START_SLOPE_MODE=this.CURRENT.slope_mode;var n=this.CFG.ARR_SLOPE_ANGLES[this.CURRENT.slope_mode],o=s<n?1:-1,r=function(){s+=o,setTimeout(function(){s!=n?(e.rotate_x_to(s),r()):(e.rotate_x_to(s),e.ANIMATION_SLOPE=!1)},10)};r()},slopeToggle:function(t){t=parseInt(t,10);var e=this.CFG.ARR_SLOPE_ANGLES;if(t<e.length){var i=e[t];this.CURRENT.slope_mode=t,this.CFG.START_SLOPE_MODE=this.CURRENT.slope_mode,this.rotate_x_to(i)}},fit3dDataToBookSize:function(){var t=this;this.FRAMES=this.getClonedData(),this.FRAMES_GL_SCALED=this.getClonedData();var e=this.$TARGET?{horizontal:0,vertical:0}:this.CFG.SPACE_AROUND_STAGE,i={width:this.FIRST_IMAGE_SIZE.w+2*t.CFG.BORDER||100,height:this.FIRST_IMAGE_SIZE.h+2*t.CFG.BORDER||100};this.CFG.DIVIDE_IMAGES&&(i.width=0<i.width%2?(i.width-1)/2:i.width/2);var a=this.$TARGET?this.TARGETSIZE:this.WINSIZE;this.BOOK_INTERNAL&&(a.height=this.CFG.MAX_SCREEN_SIZE.height);var s=this.getIconsPanelHeight(),n={w:Math.min(this.CFG.MAX_SCREEN_SIZE.width,a.width)-e.horizontal,h:Math.min(this.CFG.MAX_SCREEN_SIZE.height,a.height)-s-e.vertical},o={w:2*i.width+2*this.CFG.PASPARTU_BEHAVIORS_PARAM.width,h:i.height+2*this.CFG.PASPARTU_BEHAVIORS_PARAM.height};if(o.w>n.w||o.h>n.h)var r=n.w/o.w,h=n.h/o.h,d=Math.min(r,h);else d=1;this.GSCALE=d,bookUnscaled={width:i.width,height:i.height},i.width=Math.round(i.width*this.GSCALE),i.height=Math.round(i.height*this.GSCALE);var l={width:800,height:Math.round(800*i.height/i.width)},g=this.FRAMES[0][0].bezie.length,p=Math.abs(this.FRAMES[0][0].bezie[g-1].x),A=i.width/p,c=l.width/p,f=function(t,e){for(var i=0;i<t.length;i++)for(var a=t[i].edges3d,s=0;s<a.length;s++)a[s].width*=e,a[s].x*=e,a[s].z*=e};f(this.FRAMES[0],A),f(this.FRAMES[1],A),f(this.FRAMES_GL_SCALED[0],c),f(this.FRAMES_GL_SCALED[1],c),i.width&&i.height&&this.initWithSize(i,bookUnscaled,l)},initWithSize:function(t,e,i){var a=this;this.CFG.BOOK_GL_SIZE=i,this.CFG.BOOK_SIZE=t,this.CFG.BOOK_UNSCALED=e,this.MOUSE={startDragCoord:{x:0,y:0},oldCoord:{x:0,y:0},lastCoord:{x:0,y:0},isOverStage:!1},this.ANIMATION={SPEED:15},this.STAGE={width:2*Math.round(this.CFG.BOOK_SIZE.width+this.CFG.PASPARTU_BEHAVIORS_PARAM.width*this.GSCALE),height:Math.round(this.CFG.BOOK_SIZE.height+2*this.CFG.PASPARTU_BEHAVIORS_PARAM.height*this.GSCALE)},this.STAGE_HALF={width:this.STAGE.width/2,height:Math.round(this.STAGE.height/2)},this.STAGE_CENTER={top:0,left:0},this.OFFSET={top:Math.round(.5*(this.STAGE.height-this.CFG.BOOK_SIZE.height)),left:.5*this.STAGE.width},this.CURRENT={frame:0,sheet:-1,dragged_sheet:-1,spread:0,hoverframe:0,hoverside:"front",dir_ani:1,slope_mode:this.CFG.START_SLOPE_MODE,spreadTitle:""},this.LAST={mousemoved:!1,sheet:-1,forward:1,moved:{sheet:-1,$edges:!1,forward:0}},this.$gStage.css({width:this.STAGE.width,height:this.STAGE.height,border:"0px solid red"}),this.$gContainter.css({width:this.CFG.BOOK_SIZE.width,height:this.CFG.BOOK_SIZE.height*this.CFG.ROTATE_CENTER_OFFSET,border:"0px solid gold"}),this.calculateSheets(),this.correctStartPage(),this.SELFSHADOW={front:this.createSelfShadow("front",this.CFG.BOOK_SIZE),back:this.createSelfShadow("back",this.CFG.BOOK_SIZE)},this.SELFSHADOW_UNSCALED={front:this.createSelfShadow("front",this.CFG.BOOK_UNSCALED),back:this.createSelfShadow("back",this.CFG.BOOK_UNSCALED)},this.buildIconsPanel(),this.buildSaveMenuLayer(),!a.GLOSSY&&this.buildHelpLayer(),this.stageToCenter(),this.behavior(),this.GLOSSY&&(this.gGL?(this.updateGlStage(),this.updateGlHlpLayer()):(this.gGL=this.getGlStage(),this.createGlHlpLayer(),this.renderGL()),this.startRender()),this.rotate_x_to(this.CFG.ARR_SLOPE_ANGLES[this.CURRENT.slope_mode]),this.buildAndPreloadSheets()},updateGlStage:function(){var t=this.gGL,e=this.$gStage.width(),i=this.$gStage.height();this.$gGlossyContainter.css({width:e,height:i})
,t.renderer.setSize(e,i)},updateGlHlpLayer:function(){var t=this.gGL.helpLayers;this.gGL.bookBase.remove(t.dark.left),this.gGL.bookBase.remove(t.dark.right),this.gGL.bookBase.remove(t.light.left),this.gGL.bookBase.remove(t.light.right),this.createGlHlpLayer()},createGlHlpLayer:function(){var r=this,h=this.CFG.BOOK_SIZE,d=this.CFG.BOOK_GL_SIZE,l={dark:this.getHlpLayerBgImage("dark"),light:this.getHlpLayerBgImage("light")},g={width:300,height:200},p=this.DARK_MODE?"dark":"light",A=window[S].SKIN,c={PlainTextured:function(e){var t="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",i="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",a=e.src||t,s=THREE.FrontSide,n=e.skin,o=new THREE.Mesh(new THREE.PlaneGeometry(d.width,d.height),new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(i),transparent:!0,side:s}));return THREE.ImageUtils.loadTexture(a,undefined,function(t){o.material.map=t,n!==p&&(o.material.opacity=0),e.onReady&&e.onReady(o)}),o},backgroundImage:function(t,e){var i=document.createElement("canvas");i.width=d.width,i.height=d.height;var a=i.getContext("2d");a.drawImage(l[e],0,0,i.width,i.height),a.lineWidth=4,a.strokeStyle="dark"===e?"#888888":"#bcbcbc";var s=470/h.width;if(s=(s=2.2<s?2.2:s)<.8?.8:s,"left"===t){a.beginPath(),a.moveTo(d.width,0),a.lineTo(0,0),a.lineTo(0,d.height),a.lineTo(d.width,d.height),a.stroke();var n=c.hlpLeftImage(e);a.drawImage(n,d.width-g.width*s-20,d.height-g.height*s-20,g.width*s,g.height*s)}else{a.beginPath(),a.moveTo(0,0),a.lineTo(d.width,0),a.lineTo(d.width,d.height),a.lineTo(0,d.height),a.stroke();var o=c.hlpRightImage(e);a.drawImage(o,d.width-g.width*s-20,d.height-g.height*s-20,g.width*s,g.height*s)}return i.toDataURL()},hlpLeftImage:function(t){var e=r.getLNG("hlpClickToOpen"),i=r.getLNG("hlpUseMousewheelGL"),a=document.createElement("canvas");a.width=g.width,a.height=g.height;var s=a.getContext("2d");s.fillStyle="dark"===t?"rgba(255,255,255,1)":"rgba(0,0,0,1)",s.font="bold 20pt Arial",s.textAlign="right",s.fillText(e,g.width-10,g.height-155),s.fillStyle="dark"===t?"rgba(255,255,255,0.5)":"rgba(0,0,0,.5)",s.font="18pt Arial",s.fillText(i[0],g.width-10,g.height-110),s.fillText(i[1],g.width-10,g.height-80);var n=A.HELP_ARROW[t],o=1.5;return s.drawImage(n,a.width-n.width*o-10,a.height-n.height*o-20,n.width*o,n.height*o),a},hlpRightImage:function(t){var e=r.getLNG("toStart"),i=document.createElement("canvas");i.width=g.width,i.height=g.height;var a=i.getContext("2d");return a.fillStyle="dark"===t?"rgba(255,255,255,1)":"rgba(0,0,0,1)",a.font="20pt Arial",a.textAlign="right",a.fillText(e,g.width-10,g.height-10),i}},t=c.PlainTextured({src:c.backgroundImage("left","light"),side:"left",skin:"light",onReady:function(t){t.position.y=d.height*r.CFG.ROTATE_CENTER_OFFSET_GL,t.position.z=-5,t.position.x=.5*-d.width,r.gGL.bookBase.add(t)}}),e=c.PlainTextured({src:c.backgroundImage("right","light"),side:"right",skin:"light",onReady:function(t){t.position.y=d.height*r.CFG.ROTATE_CENTER_OFFSET_GL,t.position.z=-5,t.position.x=.5*d.width,r.gGL.bookBase.add(t)}}),i=c.PlainTextured({src:c.backgroundImage("left","dark"),side:"left",skin:"dark",onReady:function(t){t.position.y=d.height*r.CFG.ROTATE_CENTER_OFFSET_GL,t.position.z=-5,t.position.x=.5*-d.width,r.gGL.bookBase.add(t)}}),a=c.PlainTextured({src:c.backgroundImage("right","dark"),side:"right",skin:"dark",onReady:function(t){t.position.y=d.height*r.CFG.ROTATE_CENTER_OFFSET_GL,t.position.z=-5,t.position.x=.5*d.width,r.gGL.bookBase.add(t)}});this.gGL.helpLayers={light:{left:t,right:e},dark:{left:i,right:a}}},correctStartPage:function(){var t=function(t,e,i){return t<e&&(t=e),i<t&&(t=i),t};this.START_PAGE=t(this.START_PAGE,1,2*this.getTotalSheets()),this.CURRENT.spread=(this.START_PAGE-this.START_PAGE%2)/2,this.START_FROM_END=this.CURRENT.spread===this.getTotalSheets()},calculateSheets:function(){if(!this.ALLSHEETS||!this.ALLSHEETS.length){this.ALL_PAGES_MAP=[];var t=[];if(this.CFG.DIVIDE_IMAGES){this.ARR_PAGES_SRC.length<2&&this.ARR_PAGES_SRC.push(this.CFG.PAGE_DEFAULT_COLOR);a=2*this.ARR_PAGES_SRC.length;var e=[];e.push(this.ARR_PAGES_SRC[0]);for(var i=1;i<this.ARR_PAGES_SRC.length;i++)e.push(this.ARR_PAGES_SRC[i]),e.push(this.ARR_PAGES_SRC[i]);e.push(this.ARR_PAGES_SRC[0]),this.ARR_PAGES_SRC=e}else var a=this.ARR_PAGES_SRC.length;for(i=0;i<a;i++){var s=-1<this.ARR_PAGES_SRC[i].indexOf(".jpg")||-1<this.ARR_PAGES_SRC[i].indexOf(".png")||-1<this.ARR_PAGES_SRC[i].indexOf(".gif");this.ALL_PAGES_MAP[i]=s?"image":"color"}a<2*(0<a%2?(a+1)/2:a/2)&&this.ARR_PAGES_SRC.push(this.CFG.PAGE_DEFAULT_COLOR);for(i=0;i<this.ARR_PAGES_SRC.length;i+=2)t.push({front:this.ARR_PAGES_SRC[i],back:this.ARR_PAGES_SRC[i+1],opened:0});this.ALLSHEETS=t}},createSelfShadow:function(t,e){var i=document.createElement("canvas");i.width=e.width,i.height=e.height;var a=i.getContext("2d"),s=a.createLinearGradient(0,0,i.width,0);return"front"==t?(s.addColorStop(0,"rgba(0,0,0,0.15)"),s.addColorStop(.3,"rgba(0,0,0,0)")):(s.addColorStop(.7,"rgba(255,255,255,0)"),s.addColorStop(1,"rgba(255,255,255,0.15)")),a.fillStyle=s,a.fillRect(0,0,i.width,i.height),i},addCeshNames:function(t){for(var e=0;e<this.ARR_PAGES_SRC.length;e++){var i=this.ARR_PAGES_SRC[e];(-1<i.indexOf(".png")||-1<i.indexOf(".jpg")||-1<i.indexOf(".gif"))&&(this.ARR_PAGES_SRC[e]+="?cash="+t)}},getClonedData:function(){return T.extend(!0,{},{arr:this.FRDATA}).arr},getLNG:function(t){var e=this.LNG[t]||this.LNG[t.toLowerCase()];return e?e[this.CFG.LANGUAGE]:"unknown"},findBookSizeByFirstImage:function(t){for(var e=this,i="",a=0;a<this.ARR_PAGES_SRC.length&&""==i;a++){var s=this.ARR_PAGES_SRC[a];(-1<s.indexOf(".png")||-1<s.indexOf(".jpg")||-1<s.indexOf(".gif"))&&(i=s)}if(""!=i){var n=new Image;n.onload=function(){e.FIRST_IMAGE_SIZE={w:this.width,h:this.height},t&&t()},n.src=i}},isNeedResizeReposInternal:function(){if(this.BOOK_INTERNAL){var t=this.$TARGET,e={top:0,left:t.offset().left,width:t.width(),height:100},i=this.TARGETSIZE;return(this.TARGETSIZE=e).width!==i.width?"resize":e.left!==i.left&&"reposition"}return!1},behavior:function(){var r=this;this.startDrag=!1,this.HAS_BEHAVIORS||(T(window).bind("resize."+this.PRE_NAME,function(){r.zoomOut(),r.TMR_RESIZE&&(clearTimeout(r.TMR_RESIZE),r.TMR_RESIZE=null),r.TMR_RESIZE=setTimeout(function(){if(r.BOOK_INTERNAL){if(!window[S].SUPERBOOK){var t=r.isNeedResizeReposInternal();t&&r.restart(t)}}else r.restart()},300)}),T(document).bind("keyup."+this.PRE_NAME,function(t){window[S].CURRENT===r.PRE_NAME&&(39===t.keyCode?r.gotoNext():37===t.keyCode&&r.gotoPrev())}),this.HAS_BEHAVIORS=!0),{id:this.PRE_NAME+"canvasZoomWaiter",size:this.CFG.ZOOM_WAITER_SIZE,create:function(){r.$gZoomWaiter=T("#"+r.divNames.zoom_waiter).css({width:this.size,height:this.size}),r.$gZoomWaiter.html('<canvas id="'+this.id+'" width="'+this.size+'" height="'+this.size+'"></canvas>'),r.gZoomWaiterContext=document.getElementById(this.id)&&document.getElementById(this.id).getContext("2d")}}.create();var o={size:this.CFG.ZOOM_WAITER_SIZE,radius:25,draw:function(s){var n=this.size,o=this.radius,t=function(t){t.clearRect(0,0,n,n),t.beginPath(),t.lineWidth=2,t.strokeStyle="#c7c7c7";var e=n/2,i=(s-90)*Math.PI/180,a=-1.5707963267948966;t.arc(e,e,o,a,i),t.stroke()};r.gZoomWaiterContext&&t(r.gZoomWaiterContext)},show:function(){var t=r.STAGE_BOUNDING_BOX,e=r.MOUSE.startDragCoord;r.$gZoomWaiter.css({top:e.y-30-t.top,left:e.x-30-t.left}).show()},hide:function(){r.$gZoomWaiter.hide()}},h=function(t){var e,i=0,a={time:20,start:5,pause:40},s=360/(a.time-a.start),n=!1;(h=function(t){({stop_waiting:function(){n&&(n=!1,o.hide(),i&&(i=0,e&&clearTimeout(e),e=null))},verify:function(){t?this.stop_waiting():i>a.time-1?(this.stop_waiting(),r.GLOSSY||r.getSheetByIndex(r.CURRENT.dragged_sheet).find(".wholeimage").show(),r.ORDER_TO_ANIMATE=!1,r.stop_drag(),r.zoomIn(r.MOUSE.startDragCoord)):(n=!0,++i===a.start+1&&o.show(),i>a.start&&o.draw(s*(i-a.start)),e=setTimeout(function(){h()},a.pause))}}).verify()})(t)},t=T("#"+r.divNames.book_stage);t.unbind(),t.swipeMePls({preventDefault:!0,enableMouse:!1,distance:100,onSwipe:function(t){if("right"===t.direction||"left"===t.direction){var e="right"===t.direction?"gotoPrev":"gotoNext";r.clickSpeedIsOk()&&r[e]()}else"up"!==t.direction&&"down"!==t.direction||r.slopeAnimateTo(t.direction)}}),t.hover(function(){r.MOUSE.isOverStage=!0},function(){r.MOUSE.isOverStage=!1,r.ANIMATION_FLAG||r.startDrag&&r.stop_drag_and_animate()}),t.mousedown(function(t){return r.LAST.mousemoved=!1,r.ZOOM_MODE||r.ANIMATION_FLAG||!r.isMouseOverPage()||(h(),r.start_drag(t)),!1}),t.mouseup(function(){if(r.ZOOM_MODE)return!1;h("stop");var t="front"===r.CURRENT.hoverside?"next":"back";if(r.ANIMATION_FLAG)return r.LAST.mousemoved||(r.ORDER_TO_ANIMATE=t),!1;r.startDrag&&r.stop_drag_and_animate(),r.GLOSSY&&r.GL_LINK_TO_START&&r.gotoSpread(0)}),t.mousemove(function(t){if(r.MOUSE.oldCoord=r.MOUSE.lastCoord,r.MOUSE.lastCoord={x:t.pageX,y:t.pageY},r.calculateSideAndFrame(r.MOUSE.lastCoord),r.LAST.mousemoved=!0,!r.ZOOM_MODE&&h("stop"),r.ANIMATION_FLAG)return!1;if(r.startDrag){if(Math.abs(r.MOUSE.oldCoord.x-r.MOUSE.lastCoord.x)>r.CFG.MAX_MOUSE_SPEED_X)return void r.stop_drag_and_animate();var e=Math.abs(r.MOUSE.startDragCoord.x-r.MOUSE.lastCoord.x),i=Math.round(e/r.CFG.DRAG_PARAM.px_per_persent)+r.START_DRAG_FRAME||0;if(i>r.CFG.MAX_FRAME_DRAGGABLE)return void r.stop_drag_and_animate();r.drag_sheet(i)}}),t.mousewheel&&t.mousewheel(function(t,e){if(r.ANIMATION_FLAG||r.startDrag)return!1;var i=0<e?"gotoPrev":"gotoNext";return r.clickSpeedIsOk()&&r[i](),!1})},clickSpeedIsOk:function(){var t=(new Date).getTime();return this.G_TMR_SPEED_CLICK?1100<t-this.G_TMR_SPEED_CLICK&&(this.G_TMR_SPEED_CLICK=t,!0):(this.G_TMR_SPEED_CLICK=t,!0)},start_drag:function(t){this.MOUSE.startDragCoord={x:t.pageX,y:t.pageY},this.START_DRAG_FRAME=this.CURRENT.frame,this.startDrag=this.CURRENT.hoverside;var e=this.CURRENT.spread;this.CURRENT.dragged_sheet="front"==this.startDrag?e:e-1},stop_drag_and_animate:function(){var t="front"==this.startDrag?"gotoNext":"gotoPrev";this.CURRENT.dragged_sheet=-1,this.startDrag=!1,this[t]()},stop_drag:function(){this.CURRENT.dragged_sheet=-1,this.startDrag=!1},changeSpreadTitle:function(){var t=this.CURRENT.spread,e=this.ARR_PAGES_TITLE.length,i={left:"",right:""},a="";if(0===t){var s=!0;i.right=this.ARR_PAGES_TITLE[0]||""}else if(2*t-1==e){var n=!0;i.left=this.ARR_PAGES_TITLE[2*t-1]||""}else i.left=this.ARR_PAGES_TITLE[2*t-1]||"",i.right=this.ARR_PAGES_TITLE[2*t]||"";if(s)a="<p>"+i.right+"</p>";else if(n)a="<p>"+i.left+"</p>";else{var o=this.getLNG("left"),r=this.getLNG("right");i.left&&i.right?a=["<p><span>"+o+":</span> "+i.left+"<br>","<span>"+r+":</span> "+i.right+"</p>"].join(""):i.left?a="<p><span>"+o+":</span> "+i.left+"</p>":i.right&&(a="<p><span>"+r+":</span> "+i.right+"</p>")}this.CURRENT.spreadTitle=a,this.$gSpreadTitle.html(a)},calculateBounds:function(){var t=this,e=t.CFG.ICONS_PANEL,i=t.getIconsPanelHeight(),a=t.STAGE,s=t.$TARGET?t.TARGETSIZE:t.WINSIZE,n=t.$TARGET?{top:t.$TARGET.offset().top,left:t.$TARGET.offset().left}:{top:0,left:0},o=t.CFG.PASPARTU_BEHAVIORS_PARAM.height*t.GSCALE*e.overlay_pr,r=Math.round(.5*(s.height-(a.height+i-o)));r=t.BOOK_INTERNAL?0:r+T(document).scrollTop(),this.STAGE_OFFSET=offset={left:Math.round(.5*s.width-.5*a.width)+n.left,top:r+n.top},this.STAGE_CENTER={top:Math.round(offset.top+.5*a.height),left:Math.round(offset.left+.5*a.width)},this.STAGE_BOUNDING_BOX={width:a.width,height:a.height,top:offset.top,left:offset.left};var h=this.$gIconsPanel.width();this.ICONS_PANEL_BOUNDS=ipb={width:h,height:this.$gIconsPanel.height(),left:.5*s.width-.5*h+n.left,top:offset.top+t.STAGE.height-o},this.MAX_BOUNDS={width:Math.max(t.STAGE_BOUNDING_BOX.width,ipb.width),height:Math.round(ipb.top+ipb.height-t.STAGE_BOUNDING_BOX.top),top:t.STAGE_BOUNDING_BOX.top,left:Math.min(t.STAGE_BOUNDING_BOX.left,ipb.left)}},stageToCenter:function(){var s=this;this.STAGE&&(this.tmrToCenter&&clearTimeout(this.tmrToCenter),this.$gStage.hide(),this.tmrToCenter=setTimeout(function(){s.calculateBounds(),s.$gStage.css({top:s.STAGE_OFFSET.top,left:s.STAGE_OFFSET.left}).show(),s.bgLoaderShow(!1);var t=s.ICONS_PANEL_BOUNDS,e={width:s.$gBookLoader.width(),height:s.$gBookLoader.height()},i={width:s.$gSaveMenu.width(),height:s.$gSaveMenu.height()},a=s.STAGE;s.$gIconsPanel.css({top:t.top,left:t.left,visibility:"visible"}),s.$gBookLoader.css({top:.5*a.height-.5*e.height,left:.5*a.width-.5*e.width}),s.$gSaveMenu.css({top:.5*a.height-.5*i.height+s.STAGE_OFFSET.top,left:.5*a.width-.5*i.width+s.STAGE_OFFSET.left}),s.correctTargetHeight()},100))},correctTargetHeight:function(){this.BOOK_INTERNAL&&(this.$TARGET.css({height:this.MAX_BOUNDS.height}),this.$TARGET.attr("onebook3d",this.PRE_NAME)),window[S].buildNextBook()},drag_sheet:function(t){t=t<100?t:100;var e=this.CURRENT.dragged_sheet;if(this.GLOSSY)var i={gl_sheet:this.getSheetByIndex(e),gl_edges:this.getEdgesFormSheet(e),forward:"front"==this.startDrag?1:0};else{var a=this.getSheetByIndex(e);i={sheet:e,$edges:this.getEdgesFormSheet(e),forward:"front"==this.startDrag?1:0};null===this.SHEET_DISPLAYED&&(this.SHEET_DISPLAYED=e,a.find(".all_edges").show(),a.find(".wholeimage").hide())}this.moveSheetTo(t,i)},moveSheetTo:function(t,e){var i=this,a=(t=t||0,e.sheet),s=e.forward,n=2,o=i.GLOSSY?this.FRAMES_GL_SCALED[s][t].edges3d:this.FRAMES[s][t].edges3d;if(this.GLOSSY){var r=this.getHlpLayerGL();l=this.getTotalSheets();r.left&&r.right&&(i.startDrag&&!a&&s?r.left.material.opacity=(100-t)/100:i.startDrag&&a===l-1&&!s&&(r.right.material.opacity=(100-t)/100))}else{var h=this.$gHelpLayer.find(".hlpLeftSide"),d=this.$gHelpLayer.find(".hlpRightSide"),l=this.getTotalSheets();i.startDrag&&!a&&s?h.css({opacity:(100-t)/100}):i.startDrag&&a===l-1&&!s&&d.css({opacity:(100-t)/100})}if(this.GLOSSY){var g=e.gl_edges;this.CURRENT.frame=t;for(var p=0;p<o.length;p++){var A=o[p].width+n;g[p].width=A,g[p].position.x=o[p].x,g[p].position.z=-o[p].z,g[p].rotation.y=Math.PI*o[p].angle/180}this.LAST.moved={sheet:a,gl_edges:g,forward:s},this.startRender()}else{var c=e.$edges;if(c&&c.size()){this.CURRENT.frame=t;for(p=0;p<o.length;p++){A=o[p].width+n;c.eq(p).css({width:A+"px","-webkit-transform":"translate3d("+o[p].x+"px,0px,"+-o[p].z+"px) rotateY("+o[p].angle+"deg)","-moz-transform":"translate3d("+o[p].x+"px,0px,"+-o[p].z+"px) rotateY("+o[p].angle+"deg)","-ms-transform":"translate3d("+o[p].x+"px,0px,"+-o[p].z+"px) rotateY("+o[p].angle+"deg)",transform:"translate3d("+o[p].x+"px,0px,"+-o[p].z+"px) rotateY("+o[p].angle+"deg)"})}this.LAST.moved={sheet:a,$edges:c,forward:s}}}},calculateSideAndFrame:function(t){var e=this;try{var i=t.y-this.STAGE_CENTER.top,a=Math.abs(i),s=t.x-this.STAGE_CENTER.left,n=this.STAGE_HALF.width-this.CFG.BOOK_SIZE.width,o=this.CFG.BOOK_SIZE.width+Math.floor(.8*n),r=(this.STAGE_HALF.width-o)/100,h=Math.abs(s),d={x:Math.round(h/this.CFG.BOOK_SIZE.width*100),y:Math.round(100-a/this.STAGE_HALF.height*100)};i<0&&(d.y=50<d.y?100:2*d.y),o<h&&(d.x=Math.floor((this.STAGE_HALF.width-(h-1))/r)),100<d.x&&(d.x=100);var l=Math.round((.8*d.x+20)/100*d.y);this.CURRENT.hoverside=s<0?"back":"front",this.CURRENT.hoverframe=Math.round(this.CFG.SHEETS_SENSIVITY/100*l),this.LAST.sheet=this.CURRENT.sheet,this.CURRENT.sheet="front"===this.CURRENT.hoverside?this.CURRENT.spread:this.CURRENT.spread-1,this.GLOSSY&&this.CURRENT.sheet==this.ALLSHEETS.length&&(s>.75*this.CFG.BOOK_SIZE.width&&i>.5*this.STAGE_HALF.height?(e.$gStage.addClass("pointer"),e.GL_LINK_TO_START=!0):(e.GL_LINK_TO_START=!1,e.$gStage.removeClass("pointer")))}catch(g){}},getEdgesFormSheet:function(t){if(this.GLOSSY){var e=this.GL_ARR_SHEETS[t];return!(!e||!e.mesh)&&(e.mesh.position.z=1*this.CFG.GL_DEPTH_STEP,e.mesh.children)}var i=this.$ARR_SHEETS[t];return!(!i||!i.size())&&(i.css({zIndex:2e4}),i.find("div"))},getSheetByIndex:function(t){return this.GLOSSY?this.GL_ARR_SHEETS[t]:this.$ARR_SHEETS[t]},isMouseOverPage:function(){if(!this.MOUSE.isOverStage)return!1;var t=0==this.CURRENT.spread,e=this.CURRENT.spread==this.getTotalSheets();return!t&&!e||(!(!t||"front"!=this.CURRENT.hoverside)||!(!e||"back"!=this.CURRENT.hoverside))},isDirectionCorrect:function(t){var e="next"===t?1:0,i=this.ALLSHEETS.length;return!(0===this.CURRENT.spread&&!e)&&(this.CURRENT.spread!==i||!e)},startOffsetDepth:function(t,e){var i=this;if(this.GLOSSY){this.getSheetByIndex(e);var a=this.getSheetsSortedBySide();if(t)a.sidesRight[0].mesh.position.z=1*i.CFG.GL_DEPTH_STEP,T.each(a.sidesRight,function(t){t&&(this.mesh.position.z=-1*(t-1)*i.CFG.GL_DEPTH_STEP)});else{var s=1;if(h=a.sidesLeft.length)for(var n=h;0<n;n--)a.sidesLeft[n-1].mesh.position.z=s*i.CFG.GL_DEPTH_STEP,s-=1}}else{this.getSheetByIndex(e);var o=this.$gContainter.find(".side-left"),r=this.$gContainter.find(".side-right");if(t)r.eq(0).css({"-webkit-transform":"translate3d(0px,0px,1px)","-moz-transform":"translate3d(0px,0px,1px)","-ms-transform":"translate3d(0px,0px,1px)",transform:"translate3d(0px,0px,1px)"}),r.each(function(t){t&&T(this).css({"-webkit-transform":"translate3d(0px,0px,"+-1*(t-1)+"px)","-moz-transform":"translate3d(0px,0px,"+-1*(t-1)+"px)","-ms-transform":"translate3d(0px,0px,"+-1*(t-1)+"px)",transform:"translate3d(0px,0px,"+-1*(t-1)+"px)"})});else{var h;s=1;if(h=o.size())for(n=h;0<n;n--)o.eq(n-1).css({"-webkit-transform":"translate3d(0px,0px,"+s+"px)","-moz-transform":"translate3d(0px,0px,"+s+"px)","-ms-transform":"translate3d(0px,0px,"+s+"px)",transform:"translate3d(0px,0px,"+s+"px)"}),s-=1}}},startRender:function(){this.GLOSSY&&(this.renderStartedAt=new Date)},renderGL:function(){var t=this;requestAnimationFrame(function(){(new Date).getTime()-(t.renderStartedAt.getTime()||0)<3e3&&t.gGL.renderer.render(t.gGL.scene,t.gGL.camera),t.renderGL()})},getSheetsSortedBySide:function(){if(this.GLOSSY){var t=this.GL_ARR_SHEETS,e=[],i=[];for(var a in t)t.hasOwnProperty(a)&&("sideLeft"===t[a].sideClass?e.push(t[a]):i.push(t[a]));return{sidesLeft:e,sidesRight:i}}},endOffsetDepth:function(t,e){var i=this;if(this.GLOSSY){this.getSheetByIndex(e);var a=this.getSheetsSortedBySide();if(this.GL_ARR_SHEETS.length)if(t){if(h=a.sidesLeft.length)for(var s=h;0<s;s--)a.sidesLeft[h-s].mesh.position.z=-1*s*i.CFG.GL_DEPTH_STEP;a.sidesRight[0].mesh.position.z=0}else{var n=-1*(h=a.sidesRight.length);if(h)for(s=h;0<s;s--)a.sidesRight[s-1].mesh.position.z=n*i.CFG.GL_DEPTH_STEP,n+=1;a.sidesLeft[a.sidesLeft.length-1].mesh.position.z=0}}else{this.getSheetByIndex(e);var o=this.$gContainter.find(".side-left"),r=this.$gContainter.find(".side-right");if(t){if(h=o.size())for(s=h;0<s;s--)o.eq(h-s).css({"-webkit-transform":"translate3d(0px,0px,"+-1*s+"px)","-moz-transform":"translate3d(0px,0px,"+-1*s+"px)","-ms-transform":"translate3d(0px,0px,"+-1*s+"px)",transform:"translate3d(0px,0px,"+-1*s+"px)"});r.eq(0).css({"-webkit-transform":"translate3d(0px,0px,0px)","-moz-transform":"translate3d(0px,0px,0px)","-ms-transform":"translate3d(0px,0px,0px)",transform:"translate3d(0px,0px,0px)"})}else{var h;n=-1*(h=r.size());if(h)for(s=h;0<s;s--)r.eq(s-1).css({"-webkit-transform":"translate3d(0px,0px,"+n+"px)","-moz-transform":"translate3d(0px,0px,"+n+"px)","-ms-transform":"translate3d(0px,0px,"+n+"px)",transform:"translate3d(0px,0px,"+n+"px)"}),n+=1;o.last().css({"-webkit-transform":"translate3d(0px,0px,0px)","-moz-transform":"translate3d(0px,0px,0px)","-ms-transform":"translate3d(0px,0px,0px)",transform:"translate3d(0px,0px,0px)"})}}},animateSheet:function(t){if(this.isDirectionCorrect(t)){var e=this,i="next"===t?this.CURRENT.spread:this.CURRENT.spread-1,a="next"===t?1:0,s=function(){var t=100-(r+1),e=t%o;return 100-(t=e?t-e:t)};if(e.GLOSSY)this.getSheetByIndex(i);else var n=this.getSheetByIndex(i);this.SHEET_DISPLAYED=i,this.ANIMATION_FLAG=!0;var o=4,r=this.CURRENT.frame,h=a?this.CURRENT.spread:this.CURRENT.spread-1,d=this.ANIMATION.SPEED,l=this.getTotalSheets();this.startOffsetDepth(a,h);var g=s();if(e.GLOSSY)var p=e.getEdgesFormSheet(h),A={sheet:h,gl_edges:p,forward:a};else{var c=e.getEdgesFormSheet(h);A={sheet:h,$edges:c,forward:a}}var f=0===this.CURRENT.spread&a,E=1===this.CURRENT.spread&!a,S=this.CURRENT.spread===l&!a,u=this.CURRENT.spread===l-1&a;if(e.GLOSSY)var m=this.getHlpLayerGL();else var R=this.$gHelpLayer.find(".hlpLeftSide"),v=this.$gHelpLayer.find(".hlpRightSide");var _=function(){g<101?(e.moveSheetTo(g,A),e.GLOSSY?m.left&&m.right&&(f&&(m.left.material.opacity=(100-g)/100),E&&(m.left.material.opacity=g/100),S&&(m.right.material.opacity=(100-g)/100),u&&(m.right.material.opacity=g/100)):(f&&R.css({opacity:(100-g)/100}),E&&R.css({opacity:g/100}),S&&v.css({opacity:(100-g)/100}),u&&v.css({opacity:g/100})),setTimeout(function(){g+=o,_()},d)):(e.endOffsetDepth(a,h),e.switchCurrents(A))};this.GLOSSY?_():n.find(".all_edges").fadeIn("fast",function(){n.find(".wholeimage").hide(),_()})}},switchCurrents:function(t){var i=this,e=t.sheet,a=t.forward,s=a?10*(e+1):10*(this.ALLSHEETS.length-e);this.CURRENT.spread;if(this.LAST.forward=a,this.LAST.moved.forward=a?0:1,i.GLOSSY){var n=a?180:0,o=this.getSheetByIndex(e);o.sideClass="sideLeft"===o.sideClass?"sideRight":"sideLeft"}else{n=a?180:0;var r=this.getSheetByIndex(e),h=r.find(".wholeimage"),d=r.find(".all_edges");r.css({zIndex:s}).toggleClass("side-right").toggleClass("side-left"),h.css({transform:"rotateY("+n+"deg)","-webkit-transform":"rotateY("+n+"deg)","-moz-transform":"rotateY("+n+"deg)","-ms-transform":"rotateY("+n+"deg)"})}this.CURRENT.spread+=a?1:-1,this.CURRENT.frame=0,this.START_PAGE=2*i.CURRENT.spread?2*i.CURRENT.spread:1,this.buildAndPreloadSheets(),this.changeSpreadTitle(),this.pageNumbersChange(),this.bookLoaderShow(!this.didSpreadLoaded(this.CURRENT.spread));var l=this.CURRENT.spread,g=this.ARR_PAGES_SRC.length;if(0===l);else if(2*l===g);var p=this.ORDER_TO_ANIMATE;if(p&&this.isDirectionCorrect(p))i.GLOSSY?(i.ORDER_TO_ANIMATE=!1,i.animateSheet(p)):h.fadeIn("fast",function(){i.SHEET_DISPLAYED=null,d.hide(),i.ORDER_TO_ANIMATE=!1,i.animateSheet(p)});else if(i.GLOSSY){i.ORDER_TO_ANIMATE=!1,i.ANIMATION_FLAG=!1;var A=i.CURRENT.spread===i.getTotalSheets(),c=i.$G_ARR_BUTTONS.togglebook;A?(i.START_FROM_END=!0,c&&c.update()):0===i.CURRENT.spread&&(i.START_FROM_END=!1,c&&c.update())}else h.fadeIn("fast",function(){i.SHEET_DISPLAYED=null,d.hide(),i.ORDER_TO_ANIMATE=!1,i.ANIMATION_FLAG=!1;var t=i.CURRENT.spread===i.getTotalSheets(),e=i.$G_ARR_BUTTONS.togglebook;t?(i.START_FROM_END=!0,e&&e.update()):0===i.CURRENT.spread&&(i.START_FROM_END=!1,e&&e.update())})},didSpreadLoaded:function(t){if(this.GLOSSY){var e=0<t&&this.GL_ARR_SHEETS[t-1],i=t<this.ALLSHEETS.length&&this.GL_ARR_SHEETS[t];if(e)if(!e.backFilled)return!1;if(i)if(!i.frontFilled)return!1;return!0}var a=0<t&&this.$gContainter.find(".sheet"+(t-1)),s=t<this.ALLSHEETS.length&&this.$gContainter.find(".sheet"+t);return(!a||!!a.hasClass("back-filled"))&&(!s||!!s.hasClass("front-filled"))},build_background:function(){var t=this.divNames.background,e=T("#"+t);e.size()&&e.remove();var i=['<div style="opacity:1" id="'+t+'" '+(this.DARK_MODE?"":'class="light"')+" >",'<div style="text-align:center;color:gray;width:100%;height:100%;display:table;">','<span style="vertical-align:middle;display:table-cell;">','<div style="margin:auto;width:90px;height:90px;-moz-border-radius:15px;border-radius:15px;opacity:0.5;',"background:white url("+this.AJAX_LOADER+') center no-repeat;"></div>',"</span></div></div>"].join("");T("body").append(i),this.$gBookBackground=T("#"+t),this.$gBookBackground.mousewheel&&this.$gBookBackground.mousewheel(function(){return!1}),this.bgLoaderShow(!0)},buildSaveMenuLayer:function(){this.$gSaveMenu&&this.$gSaveMenu.remove();var t,e=this,i=this.divNames.save_menu,a=230,s=(t=(t=.5*this.STAGE.width)<a?a:t,['<div class="'+i+'" ','style="display:none;position:absolute;top:0px;left:0px;width:'+t+"px;z-index:"+this.CFG.ZINDEX.bookSaveMenu+";","text-align:center;background:url("+function(){var t=document.createElement("canvas");t.width=2,t.height=2;var e=t.getContext("2d");return e.fillStyle="rgba(80,80,80,.8)",e.fillRect(0,0,2,2),t.toDataURL()}()+');-moz-border-radius:7px;border-radius:7px;">','<h1 style="margin:20px 20px 10px 20px;">'+e.getLNG("askSaveImage")+"</h1>",'<p style="margin:0px 20px 20px 20px;">'+e.getLNG("askSaveLinks")+"</p>","</div>"].join(""));this.$gSaveMenu=T(s),T("body").append(this.$gSaveMenu)},buildHelpLayer:function(){var t=this,e=this.CFG.BOOK_SIZE,i=this.getLNG("hlpGoToHomelink"),a=this.getLNG("hlpClickToOpen"),s=this.getLNG("hlpUseMousewheel"),n=this.getLNG("toStart"),o=e.width<150?'class="middleSize"':"",r=e.height<130,h=this.DARK_MODE?"dark":"light",d=window[S].SKIN,l=[];l.push("<p "+o+">"),r||this.CFG.FV||l.push('<a style="display:table;margin:0px 0px 0px auto;" href="'+this.CFG.HOME_LINK+'" target="_blank" title="'+i+'"><span name="home_link" style="background:url('+d.HOME_LINK[h].toDataURL()+') no-repeat center;"></span></a>'),l.push('<span name="click_to_open"><a href="#">'+a+"</a></span>"),l.push('<span name="use_mousewheel">'+s+"</span>"),r||l.push('<span name="help_arrow" style="background:url('+d.HELP_ARROW[h].toDataURL()+') no-repeat center;"></span>'),l.push("</p>"),l=l.join("");var g=[];g.push("<p "+o+">"),g.push('<span name="goto_start"><a href="#">'+n+"</a></span>"),g.push("</p>"),g=g.join("");var p=this.START_PAGE<2?1:0,A=this.START_FROM_END?1:0,c=this.getHlpLayerBgImage(),f=['<div style="margin-top:1px;display:table;width:100%;height:100%;">','<div class="hlpLeftSide" style="opacity:'+p+";","background:url("+c.toDataURL()+");",'display:table-cell;height:100%;width:50%;text-align:right;vertical-align:bottom;">'+l+"</div>",'<div class="hlpRightSide" style="opacity:'+A+";","background:url("+c.toDataURL()+");",'display:table-cell;height:100%;width:50%;text-align:right;vertical-align:bottom;">'+g+"</div>","</div>"].join(""),E=this.DARK_MODE?"":'class="light"';this.$gHelpLayer=T("<div "+E+' id="'+this.divNames.book_help_layer+'"></div>').css({top:0,left:-1*e.width+"px",width:2*e.width-2+"px",height:e.height-1+"px"}).html(f).find("span[name=click_to_open]").click(function(){return t.gotoNext(),!1}).end().find("span[name=goto_start]").click(function(){return t.gotoSpread(0),!1}).end(),this.$gContainter.html(this.$gHelpLayer)},getHlpLayerBgImage:function(t){var e=document.createElement("canvas");e.width=100,e.height=100;var i=e.getContext("2d");return i.fillStyle=t?"dark"===t?"rgba(0,0,0,0.2)":"rgba(255,255,255,0.2)":this.DARK_MODE?"rgba(0,0,0,0.2)":"rgba(255,255,255,0.2)",i.fillRect(0,0,e.width,e.height),e},buildAndPreloadSheets:function(){var S=this,h={buildColorSheet:function(t,e,i){for(var a=0,s=i===m||m<i?1:0,n=S.FRAMES[s][a].edges3d,o=T('<span class="all_edges" style="display:none;position:absolute;top:0;left:0;width:100%;height:100%;z-index:10;"></span>'),r=0;r<n.length;r++){var h=n[r].width+u,d="translate3d("+n[r].x+"px, 0px, "+-n[r].z+"px) rotateY("+n[r].angle+"deg)",l="transform:rotateY(-180deg);-webkit-transform:rotateY(-180deg);-moz-transform:rotateY(-180deg);-ms-transform:rotateY(-180deg);",g='<span class="back" style="background:'+e.back+";"+l+'"></span>',p='<span class="front" style="background:'+e.front+';"></span>',A=T('<div style="border:0px solid red;" class="unselectable frame'+a+"-"+r+'">'+g+p+"</div>").css({position:"absolute",top:"0px",left:"0px",width:h+"px",height:S.CFG.BOOK_SIZE.height+"px",transform:d,"-webkit-transform":d,"-moz-transform":d,"-ms-transform":d});o.append(A)}t.html(o);var c=['<span class="back_image" style="border:0px solid blue;z-index:2; transform:rotateY(-180deg);-webkit-transform:rotateY(-180deg);-moz-transform:rotateY(-180deg);-ms-transform:rotateY(-180deg);"><div style=""></div></span>','<span class="front_image" style="border:0px solid green;z-index:2;"><div style=""></div></span>'].join(""),f=s?0:180,E=S.CFG.BOOK_SIZE;t.append(['<span class="wholeimage" style="display:block;position:absolute;top:0;left:0;z-index:20;width:'+E.width+"px;height:"+E.height+"px;","transform:translate3d(0px,0px,0px) rotateY("+f+"deg);-webkit-transform:translate3d(0px,0px,0px) rotateY("+f+"deg);-moz-transform:translate3d(0px,0px,0px) rotateY("+f+"deg);-ms-transform:translate3d(0px,0px,0px) rotateY("+f+'deg);">'+c+"</span>"].join(""))},fillSheetWithDefaultImages:function(t){for(var e=[S.ALLSHEETS[t].front,S.ALLSHEETS[t].back],i=0;i<e.length;i++){var a=e[i];-1<a.indexOf(".png")||-1<a.indexOf(".jpg")||-1<a.indexOf(".gif")?S.createImageFromColor(S.CFG.PAGE_DEFAULT_COLOR,t,i):S.createImageFromColor(a,t,i)}},startLoadImagesForSheet:function(t){for(var e=[S.ALLSHEETS[t].front,S.ALLSHEETS[t].back],i=0;i<e.length;i++){var a=e[i];(-1<a.indexOf(".png")||-1<a.indexOf(".jpg")||-1<a.indexOf(".gif"))&&S.loadImageForPage(a,t,i)}}},A={PlainTextured:function(e){var t="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",i=e.imageSrc||t,a=(e.color&&e.color,e.backSide?THREE.BackSide:THREE.FrontSide),s=new THREE.Mesh(new THREE.PlaneGeometry(e.size[0],e.size[1]),new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(t),side:a}));return THREE.ImageUtils.loadTexture(i,undefined,function(t){s.material.map=t,e.onReady&&e.onReady(s)}),s},buildColorSheet:function(e,d){var t=0,i=e.num===m||e.num>m?1:0,a=S.FRAMES_GL_SCALED[i][t].edges3d,l=S.CFG.BOOK_GL_SIZE.height,g=e.zindex3d,s=2*a.length;S.READY_GL_EDGES||(S.READY_GL_EDGES=[]),S.READY_GL_EDGES[e.num]=[];for(var p=function(t){S.READY_GL_EDGES[t].push(1),s===S.READY_GL_EDGES[t].length&&(h.fillSheetWithDefaultImages(e.num),h.startLoadImagesForSheet(e.num))},n=0;n<a.length;n++)a[n].width,function(t,e,i,a,s,n){var o=n.num,r=n.mesh,h=new THREE.Object3D;h.position.x=i,h.position.z=-a,h.rotation.y=Math.PI*s/180,r.add(h),r.position.z=g,r.position.y=l*S.CFG.ROTATE_CENTER_OFFSET_GL,r.name="sheet",t.bookBase.add(r);new A.PlainTextured({size:[e,l],color:d.front,onReady:function(t){t.position.x+=e/2,t.name="front",h.add(t),p(o)}}),new A.PlainTextured({size:[e,l],color:d.back,backSide:!0,onReady:function(t){t.position.x+=e/2,t.name="back",h.add(t),p(o)}})}(S.gGL,a[n].width,a[n].x,a[n].z,a[n].angle,e)}},t=function(t){if(!S.SHEETS_WAS_BUILT[t]){S.SHEETS_WAS_BUILT[t]=!0;var e=t===m||m<t,i=e?"right":"left",a={num:t,sideClass:e?"sideRight":"sideLeft",zindex3d:-1*l[i]*S.CFG.GL_DEPTH_STEP,mesh:new THREE.Object3D},s=S.getColorsBySheet(t);S.GL_ARR_SHEETS[t]=a,l[i]+=1,A.buildColorSheet(a,s)}},e=function(t){if(!S.SHEETS_WAS_BUILT[t]){S.SHEETS_WAS_BUILT[t]=!0;var e=t===m||m<t,i=e?10*(S.ALLSHEETS.length-t):10*(t+1),a=e?"side-right":"side-left",s=e?"right":"left",n=-1*l[s],o=T(['<div  num="'+t+'" class="sheet'+t+" "+a+'" ','style="transform:translate3d(0px,0px,'+n+"px);-webkit-transform:translate3d(0px,0px,"+n+"px);-moz-transform:translate3d(0px,0px,"+n+"px);-ms-transform:translate3d(0px,0px,"+n+"px);","position:absolute;top:0;left:0;z-index:"+i+'"></div>'].join(""));e?S.$gContainter.append(o):S.$gHelpLayer.after(o),l[s]+=1,S.$ARR_SHEETS[t]=o;var r=S.getColorsBySheet(t);h.buildColorSheet(o,r,t),h.fillSheetWithDefaultImages(t),h.startLoadImagesForSheet(t)}},u=1.2,i=this.LAST.forward,a=(this.GIF,this.CFG.NUMBEROF_PRELOAD_SHEETS),s=this.ALLSHEETS.length,m=this.CURRENT.spread,n=m==s,o=m-a,r=m+a;if(this.GLOSSY)var d=function(t){var e=0,i=S.GL_ARR_SHEETS;for(var a in i)i.hasOwnProperty(a)&&i[a].sideClass===t&&e++;return e},l={left:d("sideLeft"),right:d("sideRight")};else l={left:this.$gContainter.find(".side-left").size(),right:this.$gContainter.find(".side-right").size()};n&&o--,o=o<0?0:o,r=r<s?r:s-1;for(var g=function(){for(var t=[],e=[],i=o;i<r+1;i++)i===m||m<i?e.push(i):t.push(i);return t.reverse().concat(e)}(),p=0;p<g.length;p++)this.GLOSSY?t(g[p]):e(g[p]);this.deleteSheet(i?o-1:r+1)},deleteSheet:function(t){if(t<0||t>this.ALLSHEETS.length-1||!this.SHEETS_WAS_BUILT[t])return!1;if(this.SHEETS_WAS_BUILT[t]=!1,this.IMG_NOW_LOADING[2*t]&&(this.IMG_NOW_LOADING[2*t].src=this.GIF,this.IMG_NOW_LOADING[2*t].onload=!1),this.IMG_NOW_LOADING[2*t+1]&&(this.IMG_NOW_LOADING[2*t+1].src=this.GIF,this.IMG_NOW_LOADING[2*t+1].onload=!1),this.GLOSSY){var e=this.getSheetByIndex(t);e&&(this.gGL.bookBase.remove(e.mesh),delete this.GL_ARR_SHEETS[t])}else this.$gContainter.find("div.sheet"+t).remove()},getColorsBySheet:function(t){var e=this.CFG.PAGE_DEFAULT_COLOR,i=this.ALLSHEETS[t].front;i=-1<i.indexOf(".")?e:i;var a=this.ALLSHEETS[t].back;return{front:i,back:a=-1<a.indexOf(".")?e:a}},createImageFromColor:function(t,e,i){var s=this,a=function(){var t=document.createElement("canvas"),e=s.CFG.BOOK_SIZE.width,i=s.CFG.BOOK_SIZE.height;t.width=s.CFG.DIVIDE_IMAGES?2*e:e,t.height=i;var a=t.getContext("2d");return a.fillStyle="rgba(0,0,0,0)",a.fillRect(0,0,t.width,t.height),t};this.shredAndFill({img:a(),src:t,sheet:e,page:i})},loadImageForPage:function(t,e,i){var a=this,s=2*e+i;this.NOW_LOADING_COUNTER++,this.IMG_NOW_LOADING[s]=new Image,
this.IMG_NOW_LOADING[s].onload=function(){a.NOW_LOADING_COUNTER--,a.update_queue_loaded_images({img:this,src:t,sheet:e,page:i})},setTimeout(function(){a.IMG_NOW_LOADING&&a.IMG_NOW_LOADING[s]&&(a.IMG_NOW_LOADING[s].src=t)},500)},update_queue_loaded_images:function(t){var e=this,i=function(){if(!e.ANIMATION_FLAG){var t=e.QUEUE_IMAGES_LOADED.shift();t&&e.shredAndFill(t)}e.QUEUE_IMAGES_LOADED.length&&(e.TMR_QUEUE=setTimeout(function(){i()},10))};this.TMR_QUEUE&&clearTimeout(this.TMR_QUEUE),this.QUEUE_IMAGES_LOADED.push(t),i()},buildResizedImage:function(t,e,i,a){var s=this.getString([76,73,77,73,84,69,68,0,76,73,71,72,84,0,86,69,82,83,73,79,78]),n=i.img,o=0<i.page?"back":"front",r=this.getColorsBySheet(i.sheet),h=i.sheet,d=document.createElement("canvas"),l=t.width,g=t.height;l=this.CFG.DIVIDE_IMAGES?2*l:l,d.width=l,d.height=g;var p=d.getContext("2d");p.fillStyle=r[o],p.fillRect(0,0,l,g);var A=this.CFG.BORDER*e,c=d.width-2*A,f=d.height-2*A;if(n.width>c||n.height>f)var E=c/n.width,S=f/n.height,u=Math.min(E,S),m=E==u,R=m?c:Math.floor(n.width*u),v=m?Math.floor(n.height*u):f;else R=n.width,v=n.height;p.drawImage(n,A,A,R,v);var _=this.getTotalSheets(),T=0===i.sheet&&0===i.page,O=i.sheet===_-1&&1===i.page;if(a){var L=this.SELFSHADOW[o];this.CFG.DIVIDE_IMAGES?p.drawImage(L,0<i.page?0:this.CFG.BOOK_SIZE.width,0):T||O||p.drawImage(L,0,0)}if(this.GLOSSY&&(!this.CFG.FV&&h>parseInt(String.fromCharCode(50),10))){var I=.7,w=300,G=82,C=20,x=30,N=document.createElement("canvas");N.width=w,N.height=G;var b=N.getContext("2d");b.fillStyle="rgba(200,200,200,.4)",b.fillRect(10,10,N.width-20,N.height-20),b.lineWidth=10,b.strokeStyle="rgba(200,200,200,.4)",b.beginPath(),b.moveTo(x,0),b.lineTo(0,0),b.lineTo(0,C),b.moveTo(w-x,0),b.lineTo(w,0),b.lineTo(w,C),b.moveTo(w,G-C),b.lineTo(w,G),b.lineTo(w-x,G),b.moveTo(0,G-C),b.lineTo(0,G),b.lineTo(x,G),b.stroke(),b.fillStyle="#ffffff",b.font="16pt Arial",b.textAlign="center",b.fillText(s,N.width/2,50),p.drawImage(N,d.width/2-N.width*I/2,d.height/2-N.height*I/2,N.width*I,N.height*I)}return d},shredAndFill:function(t){var S=this;if(!this.CFG.BOOK_SIZE.width||!this.CFG.BOOK_SIZE.height)return!1;var e={switchSheetLoadingStatus:function(){var t=2*a+i,e="color"===S.ALL_PAGES_MAP[t];S.GLOSSY?v&&(v[R+"Loading"]?(delete v[R+"Loading"],v[R+"Filled"]=!0):e?v[R+"Filled"]=!0:v[R+"Loading"]=!0):_.hasClass(R+"-loading")?_.removeClass(R+"-loading").addClass(R+"-filled"):e?_.addClass(R+"-filled"):_.addClass(R+"-loading")},cutImagesAndInsertIntoEdges:function(t){for(var e,i,a,s=0,n=t.height,o=t.width,r=0;r<u.length;r++){i=Math.round(u[r].width),S.CFG.DIVIDE_IMAGES||("front"===R?(e=s,s+=i,a=o<e+i?o-e:i):(e=o-(s+=a=i))<0&&(a=i+e,e=0));var h=document.createElement("canvas");h.width=a,h.height=n;var d=h.getContext("2d");S.GLOSSY&&"back"===R&&(d.translate(a,0),d.scale(-1,1)),d.drawImage(t,e,0,a,n,0,0,a,n);var l=h.toDataURL(),g=document.createElement("img");g.src=l,m.push(g)}if(S.GLOSSY){if(v&&v.mesh){var p=v.mesh.children;T.each(p,function(t){var e=this.getObjectByName(R);THREE.ImageUtils.loadTexture(m[t].src,undefined,function(t){e&&(e.material.map=t)})})}}else{var A=_.find(".wholeimage ."+R+"_image"),c=A.find("div"),f=_.find("."+R),E="back"===R?-1:1;c.css({background:"url("+t.toDataURL()+") "+E+"px 0px no-repeat"}),A.css({background:"url("+t.toDataURL()+") 0px 0px no-repeat"}),f.each(function(t){T(this).css({background:"url("+m[t].src+") no-repeat",backgroundSize:"100% 100%"})})}}},u=S.FRAMES[0][this.FIRST_FRAME].edges3d,m=[],i=(t.img,t.page),a=t.sheet,R=0<i?"back":"front";if(this.GLOSSY)var v=S.GL_ARR_SHEETS[a];else var _=this.$ARR_SHEETS[a];this.startRender(),e.switchSheetLoadingStatus();var s=this.buildResizedImage(this.CFG.BOOK_SIZE,this.GSCALE,t,"selfShadow");e.cutImagesAndInsertIntoEdges(s),this.bookLoaderShow(!this.didSpreadLoaded(this.CURRENT.spread))},saveImagesAs:function(){var i=this,s=function(t){for(var e=t.toDataURL().match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/),i=atob(e[3]),a=new ArrayBuffer(i.length),s=new Uint8Array(a),n=0;n<s.length;n++)s[n]=i.charCodeAt(n);return new Blob([s],{type:e[1]})},a={loadImage:function(t){var e=new Image;e.onload=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height,t.getContext("2d").drawImage(this,0,0,this.width,this.height),a.saveImage(t)},e.src=t},saveImage:function(t){var e=window.URL||webkitURL,i=document.createElement("a"),a=s(t);i.download="photo.png",i.href=e.createObjectURL(a),document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout(function(){e.revokeObjectURL(a)},100)},showMenu:function(){i.$gSaveMenu.toggle()}},t=0==this.CURRENT.spread,e=this.CURRENT.spread==this.getTotalSheets(),n=this.ARR_PAGES_SRC;t?a.loadImage(n[0]):e?a.loadImage(n[n.length-1]):(i.$gSaveMenu.find("a").unbind().each(function(e){T(this).click(function(){var t=e?2*i.CURRENT.spread:2*i.CURRENT.spread-1;return n[t]&&a.loadImage(n[t]),a.showMenu(),!1})}),a.showMenu())}},s={init:function(t){this.MATH=n.init(),this.onReady=t.onReady,this.ARR_ANIMATIONS=[],this.CURRENT_FLIP_NAME=t.flip||"",this.FLIP_NAMES=[],this.CURRENT_KEYFRAME=1,this.CURRENT_LINE=0,this.CFG={SPEED_ANIMATION:15,BOOK_HEIGHT:300,YSCALETOP:.3,YSCALE:.08,BEZIE_ROUGH:window[S].GLOSSY?10:4,BOOK_ROTATE_X:0,ARR_BOOK_WIDTH:[]},this.ARR_ANI=['<div id="animations" style="display:none;">','<div class="book" name="basic">','<div class="points" xy="-40,0 -60,0 -80,0 -80,0 -120,0"></div>','<div class="frame" fr="0" ang="0 0 0 0 0"></div>','<div class="frame" fr="30" ang="100 15 5 5 -30"></div>','<div class="frame" fr="60" ang="140 120 40 40 -30"></div>','<div class="frame" fr="80" ang="130 145 195 195 190"></div>','<div class="frame" fr="100" ang="180 180 180 180 180"></div>',"</div>",'<div class="book" name="soft">','<div class="points" xy="-40,0 -60,0 -80,0 -80,0 -120,0"></div>','<div class="frame" fr="0" ang="0 0 0 0 0"></div>','<div class="frame" fr="30" ang="95 60 10 10 -50"></div>','<div class="frame" fr="60" ang="150 145 60 60 -30"></div>','<div class="frame" fr="80" ang="175 170 105 105 60"></div>','<div class="frame" fr="100" ang="180 180 180 180 180"></div>',"</div>"].join(""),this.load_animations_from_html()},load_animations_from_html:function(){var e=this,i=function(t){for(var e=0,i=0;i<t.length;i++)e+=t[i][0];return e=e<0?-1*e:e};T(this.ARR_ANI).find(".book").each(function(){var s=[],t=T(this).attr("name"),n=T(this).find(".points").attr("xy").split(" ").map(function(t){return t.split(",").map(function(t){return parseInt(t)})});T(this).find(".frame").each(function(){for(var t=parseInt(T(this).attr("fr"),10),e=T(this).attr("ang").split(" ").map(function(t){return parseInt(t)}),i={frame:t,line:[]},a=0;a<n.length;a++)i.line[a]={xy:n[a],ang:e[a],center:[0,0]};s.push(i)}),e.CFG.ARR_BOOK_WIDTH.push(i(n)),e.FLIP_NAMES.push(t),e.ARR_ANIMATIONS[t]=s}),this.CURRENT_FLIP_NAME=-1!==T.inArray(this.CURRENT_FLIP_NAME,this.FLIP_NAMES)?this.CURRENT_FLIP_NAME:this.FLIP_NAMES[0];var t=window[S].FLIPS[this.CURRENT_FLIP_NAME];t?this.onReady(t):this.rebuild()},rebuild:function(){var t=this.ARR_ANIMATIONS[this.CURRENT_FLIP_NAME];this.FIRST_KEYFRAME=t[0].frame;var e=this.buildAllFramesFrom(t);this.ALL_FRAMES=this.calculateCenters(e),this.calculateBezie(),this.calculateEdgeSkewY(),this.CFG.AMOUNT_ADGES_3D=this.ALL_FRAMES[0].edges3d.length;for(var i=[],a=0;a<this.ALL_FRAMES.length;a++){for(var s=this.ALL_FRAMES[a],n=[],o=0;o<s.edges3d.length;o++)n[o]={angle:180-s.edges3d[o].angle,width:s.edges3d[o].width,x:-1*s.edges3d[o].x,z:s.edges3d[o].z};i.push({bezie:s.bezie,edges3d:n,frame:s.frame,keyframe:s.keyframe,line:s.line,skewYbottom:s.skewYbottom,skewYtop:s.skewYtop})}var r=[this.ALL_FRAMES,i];window[S].FLIPS[this.CURRENT_FLIP_NAME]=r,this.onReady(r)},buildAllFramesFrom:function(t){var e=[];if((t=t).length<1)return[];for(var i=0;i<t.length;i++)e[t[i].frame]=T.extend(!0,{},t[i]),e[t[i].frame].keyframe=!0;for(i=1;i<t.length;i++)for(var a=t[i-1],s=t[i],n=s.frame-a.frame,o=1;o<n;o++){for(var r=a.frame+o,h=[],d=0;d<s.line.length;d++){var l=Math.floor((s.line[d].ang-a.line[d].ang)/n*o+a.line[d].ang),g=[s.line[d].xy[0],s.line[d].xy[1]];h.push({xy:g,ang:l,center:[0,0]})}e[r]={frame:r,line:h}}return e},calculateCenters:function(t){var d=this;t=t;return T.each(t,function(t){if(!(t<d.FIRST_KEYFRAME)){var e=this.line;for(t=0;t<e.length;t++){var i=e[t].ang,a=0<i?1:-1,s=i*a,n=e[t].center,o=[d.MATH.COS[s],a*-d.MATH.SIN[s],n[0],a*d.MATH.SIN[s],d.MATH.COS[s],n[1]],r=e[t].xy,h=d.MATH.xy_matrix2d(r,o);e[t].xy=h,e[t+1]&&(e[t+1].center=h)}}}),t},calculateBezie:function(){var t=this.ALL_FRAMES,l=this.CFG.BEZIE_ROUGH;T.each(t,function(){var t=this.line;if(!(t.length<3)){for(var e=[{x:0,y:0}],i=0,a=0,s=0,n=[0,0],o=t[0].xy,r=t[1].xy,h=t[2].xy,d=1;d<l;d++)a=(1-(i=1/l*d))*(1-i)*(1-i)*n[0]+3*i*(1-i)*(1-i)*o[0]+3*i*i*(1-i)*r[0]+i*i*i*h[0],s=(1-i)*(1-i)*(1-i)*n[1]+3*i*(1-i)*(1-i)*o[1]+3*i*i*(1-i)*r[1]+i*i*i*h[1],e.push({x:a,y:s});if(e.push({x:h[0],y:h[1]}),5===t.length||5<t.length){for(i=0,a=0,s=0,n=t[2].xy,o=t[3].xy,r=t[4].xy,d=1;d<l;d++)a=(1-(i=1/l*d))*(1-i)*n[0]+2*i*(1-i)*o[0]+i*i*r[0],s=(1-i)*(1-i)*n[1]+2*i*(1-i)*o[1]+i*i*r[1],e.push({x:a,y:s});e.push({x:r[0],y:r[1]})}this.bezie=e}}),this.ALL_FRAMES=t},calculateEdgeSkewY:function(){var g=this.CFG.BOOK_HEIGHT,p=this.CFG.YSCALE,A=this.CFG.YSCALETOP,t=this.ALL_FRAMES;T.each(t,function(){for(var t=this.bezie,e=[],i=[],a=[],s=0;s<t.length-1;s++){var n,o,r,h;n=t[s],o=t[s+1];var d=Math.sqrt((o.y-n.y)*(o.y-n.y)+(o.x-n.x)*(o.x-n.x)),l=(180*Math.atan2(o.y-n.y,o.x-n.x)/Math.PI).toFixed(15);a.push({x:n.x,z:n.y,width:d,angle:l}),r=n.y*A-g,h=o.y*A-g,e.push((180*Math.atan2(h-r,o.x-n.x)/Math.PI).toFixed(15)),y1bottom=n.y*p-g,y2bottom=o.y*p-g,i.push((180*Math.atan2(y2bottom-y1bottom,o.x-n.x)/Math.PI).toFixed(15))}this.edges3d=a,this.skewYtop=e,this.skewYbottom=i}),this.ALL_FRAMES=t},get_total_keyframes:function(){return this.ARR_ANIMATIONS[this.CURRENT_ANIMATION].length},get_total_lines:function(){return this.ALL_FRAMES[this.FIRST_KEYFRAME].line.length}},n={init:function(){return this.SIN=[],this.COS=[],this._calculate(),this},_calculate:function(){for(var t=0;t<360;t++)this.SIN[t]=Math.sin(t*Math.PI/180).toFixed(15);for(t=0;t<360;t++)this.COS[t]=Math.cos(t*Math.PI/180).toFixed(15);var e;(e=Array.prototype).map||(e.map=function(t){for(var e=this.length,i=new Array(e),a=0;a<e;a++)a in this&&(i[a]=t.call(!1,this[a],a,this));return i})},xy_matrix2d:function(t,e){var i=t;i.push(1);var a=e;return[a[0]*i[0]+a[1]*i[1]+a[2]*i[2],a[3]*i[0]+a[4]*i[1]+a[5]*i[2]]}},o=window[S].NUMBER;return window[S].NUMBER+=1,window[S].queueBooksBuilding.push({arrSrc:t,options:e,target:i}),o&&window[S].buildingNowFlag||window[S].buildNextBook(),this},T.fn.onebook=function(t,e){return T.onebook(t,e,this),this}}(jQuery),function(l){l.fn.swipeMePls=function(t){var r,h,d=l.extend({preventDefault:!0,enableMouse:!0,distance:100,onTouch:function(){},onMove:function(){},onSwipe:function(){},onEnd:function(){}},t||{});return this.each(function(){var a,s,n,o,t=l(this),e=!1,i={touchStart:function(t){if(!(1<t.targetTouches.length)){var e=t.targetTouches[0];n=e.pageX,o=e.pageY,a=e.pageX,s=e.pageY,r=new Date,d.onTouch({clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY})}},mouseDown:function(t){e=!0,n=t.pageX,o=t.pageY,a=t.pageX,s=t.pageY,r=new Date,d.onTouch({clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY,screenX:t.screenX,screenY:t.screenY}),d.preventDefault&&t.preventDefault()},mouseMove:function(t){e&&(d.onMove({deltaX:t.pageX-a,deltaY:t.pageY-s,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY,screenX:t.screenX,screenY:t.screenY}),a=t.pageX,s=t.pageY),d.preventDefault&&t.preventDefault()},moveEnd:function(t){e&&(e=!1,i.testSwipe()),d.preventDefault&&t.preventDefault(),d.onEnd()},touchEnd:function(){e=!1,i.testSwipe(),d.onEnd()},touchMove:function(t){if(!(1<t.targetTouches.length)){var e=t.targetTouches[0];d.onMove({deltaX:e.pageX-a,deltaY:e.pageY-s,clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,evt:t}),a=e.pageX,s=e.pageY,d.preventDefault&&t.preventDefault()}},testSwipe:function(){var t=a-n,e=s-o;if(h=Math.abs(new Date-r)/1e3,Math.abs(t)>=Math.abs(e)){if(Math.abs(t)>=d.distance){var i=0<=t?"right":"left";d.onSwipe({direction:i,distance:Math.abs(t),speed:Math.abs(t)/h,time:h})}}else if(Math.abs(e)>=d.distance){i=0<=e?"down":"up";d.onSwipe({direction:i,distance:Math.abs(e),speed:Math.abs(e)/h,time:h})}},touchCancel:function(){}};d.enableMouse&&(t.mousedown(function(t){1==((t=t||window.event).keyCode||t.which)&&i.mouseDown(t)}),t.mouseup(i.moveEnd),l("body").mouseup(i.moveEnd),t.mousemove(i.mouseMove)),this.addEventListener("touchstart",i.touchStart),this.addEventListener("touchmove",i.touchMove),this.addEventListener("touchend",i.touchEnd),this.addEventListener("touchcancel",i.touchCancel)})}}(jQuery);